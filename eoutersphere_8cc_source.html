<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Votca: ctp/src/libctp/calculators/eoutersphere.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Votca
   &#160;<span id="projectnumber">1.3-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2b6ab31139d7f950fccda5a3d4ed6553.html">ctp</a></li><li class="navelem"><a class="el" href="dir_101dfb3d08b68ae463d7ddea8bbbf078.html">src</a></li><li class="navelem"><a class="el" href="dir_abe70163b6f0298289ac687497fc6bd6.html">libctp</a></li><li class="navelem"><a class="el" href="dir_4c3738f15f413d91509375b7572524e7.html">calculators</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">eoutersphere.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="eoutersphere_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *            Copyright 2009-2012 The VOTCA Development Team</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *                       (http://www.votca.org)</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Licensed under the Apache License, Version 2.0 (the &quot;License&quot;)</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * You may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *              http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * limitations under the License.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="eoutersphere_8h.html">eoutersphere.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">namespace </span>votca { <span class="keyword">namespace </span>ctp {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// +++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// EOUTERSPHERE MEMBER FUNCTIONS //</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// +++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#adaa9bc993531bd639ce6074371c7a480">   31</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#adaa9bc993531bd639ce6074371c7a480" title="Initializes a calculator from an XML file with options.">EOutersphere::Initialize</a>(<a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage program options with xml serialization functionality">Property</a> *opt) {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// update options with the VOTCASHARE defaults   </span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1Calculator.html#a6631149cbfd5652dde8f238c70700610" title="Updates options with default options stored in VOTCASHARE.">UpdateWithDefaults</a>( opt );</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordtype">string</span> key = <span class="stringliteral">&quot;options.&quot;</span> + <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a3a936ab121af12b48ffe02da4d3da971" title="Calculator name.">Identify</a>();</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">/* ---- OPTIONS.XML Structure -----</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">     * &lt;eoutersphere&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">     *      &lt;multipoles&gt;MULTIPOLES.XML&lt;/multipoles&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">     *      &lt;method&gt;&lt;/method&gt;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">     *      &lt;pekar&gt;&lt;/pekar&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">     *      &lt;cutoff&gt;&lt;/cutoff&gt;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">     * &lt;/eoutersphere&gt;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#a3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">&quot;.method&quot;</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#ac6d7e21b86efdf7525d0cc9f8e8feb5c" title="return value as type">as</a>&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;constant&quot;</span>) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a35e4838a6dc6a8e87fb89edb6c01ea46">_lambdaConstant</a> = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#a3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">&quot;.lambdaconst&quot;</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#ac6d7e21b86efdf7525d0cc9f8e8feb5c" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt; ();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;spheres&quot;</span>) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8fb076fdd6fb307eac18d7b5f387b518">_pekarFactor</a> = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#a3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">&quot;.pekar&quot;</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#ac6d7e21b86efdf7525d0cc9f8e8feb5c" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt; ();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        list&lt; Property* &gt; typeinfo = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#ad7987d4a19543a46ca8d38dd8b26121a" title="select property based on a filter">Select</a>(key+<span class="stringliteral">&quot;.segment&quot;</span>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        list&lt; Property* &gt; ::iterator rit;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">for</span> (rit = typeinfo.begin(); rit != typeinfo.end(); ++rit) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordtype">string</span> type = (*rit)-&gt;get(<span class="stringliteral">&quot;type&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keywordtype">double</span> radius = (*rit)-&gt;get(<span class="stringliteral">&quot;radius&quot;</span>).as&lt;<span class="keywordtype">double</span>&gt;();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#adad1e8c4238a0b036e01d42fa05a49fe">_radius</a>[type] = radius;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;dielectric&quot;</span>) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8fb076fdd6fb307eac18d7b5f387b518">_pekarFactor</a> = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#a3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">&quot;.pekar&quot;</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#ac6d7e21b86efdf7525d0cc9f8e8feb5c" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt; ();</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#aa545b1397aeb7d0e062b4b1e00d93e5d">_lambdaCutoff</a> = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#a3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">&quot;.cutoff&quot;</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#ac6d7e21b86efdf7525d0cc9f8e8feb5c" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt; ();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;ERROR: Typo? Method for reorg. energy calc.: &quot;</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Unrecognized &lt;method&gt; in options file.&quot;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a27b5118c08303f51fda86877a87853c3">EStatify</a>(NULL, opt);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a27b5118c08303f51fda86877a87853c3">   81</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a27b5118c08303f51fda86877a87853c3">EOutersphere::EStatify</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage program options with xml serialization functionality">Property</a> *options) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... Estatify system: &quot;</span>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">string</span> key = <span class="stringliteral">&quot;options.eoutersphere&quot;</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">string</span> allocFile = options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#a3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">&quot;.multipoles&quot;</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#ac6d7e21b86efdf7525d0cc9f8e8feb5c" title="return value as type">as</a>&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// ++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// Load polar-site indices from XML //</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// ++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// =&gt; Output to maps:</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    map&lt;string, vector&lt;int&gt; &gt; alloc_frag_mpoleIdx;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    map&lt;string, vector&lt;string&gt; &gt; alloc_frag_mpoleName;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    map&lt;string, string &gt; alloc_seg_mpoleFiles_n;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    map&lt;string, string &gt; alloc_seg_mpoleFiles_e;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    map&lt;string, string &gt; alloc_seg_mpoleFiles_h;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage program options with xml serialization functionality">Property</a> allocation; <span class="comment">// &lt;- Which polar sites are part of which fragment?</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="namespacevotca_1_1tools.html#af135f0aaaac442ad3d3285a3b1d539b7">load_property_from_xml</a>(allocation, allocFile.c_str());</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">/* --- MULTIPOLES.XML Structure ---</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">     * &lt;topology&gt;</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">     *     &lt;molecules&gt;</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">     *          &lt;molecule&gt;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">     *          &lt;name&gt;&lt;/name&gt;</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">     *          &lt;segments&gt;</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">     *              &lt;segment&gt;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">     *              &lt;name&gt;DCV&lt;/name&gt;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">     *              &lt;multipoles_n&gt;&lt;/multipoles_n&gt;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">     *              &lt;multipoles_e&gt;&lt;/multipoles_e&gt;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">     *              &lt;multipoles_h&gt;&lt;/multipoles_h&gt;</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">     *              &lt;map2md&gt;&lt;/map2md&gt;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">     *              &lt;fragments&gt;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">     *                  &lt;fragment&gt;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">     *                  &lt;name&gt;&lt;/name&gt;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">     *                  &lt;mpoles&gt;&lt;/mpoles&gt;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">     *                  &lt;/fragment&gt;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">     *              &lt;/fragments&gt;</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">     *              ...</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">     *              ...</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    key = <span class="stringliteral">&quot;topology.molecules.molecule&quot;</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    list&lt;Property *&gt; mols = allocation.<a class="code" href="classvotca_1_1tools_1_1Property.html#ad7987d4a19543a46ca8d38dd8b26121a" title="select property based on a filter">Select</a>(key);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    list&lt;Property *&gt;::iterator molit;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">for</span> (molit = mols.begin(); molit != mols.end(); molit++) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordtype">string</span> molName = (*molit)-&gt;get(<span class="stringliteral">&quot;name&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        key = <span class="stringliteral">&quot;segments.segment&quot;</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        list&lt;Property *&gt; segs = (*molit)-&gt;Select(key);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        list&lt;Property *&gt;::iterator segit;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">for</span> (segit = segs.begin(); segit != segs.end(); segit++) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordtype">string</span> segName = (*segit)-&gt;get(<span class="stringliteral">&quot;name&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="comment">// GDMA filenames for cation (h), neutral (n), anion (e) state</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordtype">string</span> mpoleFile_n = (*segit)-&gt;get(<span class="stringliteral">&quot;multipoles_n&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            alloc_seg_mpoleFiles_n[segName] = mpoleFile_n;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">if</span> ( (*segit)-&gt;exists(<span class="stringliteral">&quot;multipoles_e&quot;</span>)) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="keywordtype">string</span> mpoleFile_e = (*segit)-&gt;get(<span class="stringliteral">&quot;multipoles_e&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                alloc_seg_mpoleFiles_e[segName] = mpoleFile_e;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">if</span> ( (*segit)-&gt;exists(<span class="stringliteral">&quot;multipoles_h&quot;</span>)) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                <span class="keywordtype">string</span> mpoleFile_h = (*segit)-&gt;get(<span class="stringliteral">&quot;multipoles_h&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                alloc_seg_mpoleFiles_h[segName] = mpoleFile_h;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="comment">// Default: Project multipoles onto rigidified coordinates</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">if</span> ( (*segit)-&gt;exists(<span class="stringliteral">&quot;map2md&quot;</span>)) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keywordtype">int</span> map2md = (*segit)-&gt;get(<span class="stringliteral">&quot;map2md&quot;</span>).as&lt;<span class="keywordtype">int</span>&gt;();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a9bb5b12d6ff277858ee1ca273d642ce7">_map2md</a>[segName] = (map2md == 0) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a9bb5b12d6ff277858ee1ca273d642ce7">_map2md</a>[segName] = <span class="keyword">false</span>; <span class="comment">// i.e. map to rigidified coordinates</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            key = <span class="stringliteral">&quot;fragments.fragment&quot;</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            list&lt;Property *&gt; frags = (*segit)-&gt;Select(key);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            list&lt;Property *&gt;::iterator fragit;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordflow">for</span> (fragit = frags.begin(); fragit != frags.end(); fragit++) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                <span class="keywordtype">string</span> fragName = (*fragit)-&gt;get(<span class="stringliteral">&quot;name&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                <span class="keywordtype">string</span> mapKeyName = fragName + segName + molName;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordtype">string</span> mpoles = (*fragit)-&gt;get(<span class="stringliteral">&quot;mpoles&quot;</span>).as&lt;<span class="keywordtype">string</span>&gt; ();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tokPoles(mpoles, <span class="stringliteral">&quot; \t\n&quot;</span>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                vector&lt;string&gt; mpoleInfo;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                tokPoles.ToVector(mpoleInfo);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                vector&lt;int&gt; mpoleIdcs;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                vector&lt;string&gt; mpoleNames;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                vector&lt;string&gt; ::iterator strit;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">for</span> (strit=mpoleInfo.begin(); strit&lt;mpoleInfo.end(); strit++) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tokPoleInfo( (*strit), <span class="stringliteral">&quot; :&quot;</span>);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    vector&lt;string&gt; poleInfo;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    tokPoleInfo.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#a344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>(poleInfo);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    <span class="keywordtype">int</span> mpoleIdx = <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">int</span>&gt;(poleInfo[0]);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    <span class="keywordtype">string</span> mpoleName = poleInfo[1];</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    mpoleIdcs.push_back(mpoleIdx);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                    mpoleNames.push_back(mpoleName);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                alloc_frag_mpoleIdx[mapKeyName] = mpoleIdcs;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                alloc_frag_mpoleName[mapKeyName] = mpoleNames;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// ++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// Parse GDMA punch files //</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// ++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// =&gt; Output to PolarSite Container (template container)</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    map&lt;string, vector&lt;PolarSite*&gt; &gt; map_seg_polarSites;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    map&lt;string, vector&lt;bool&gt; &gt;       map_seg_chrgStates;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// Multipoles for neutral state</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordtype">int</span> state = 0;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    map&lt;string, string &gt; ::iterator strit;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">for</span> (strit = alloc_seg_mpoleFiles_n.begin();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;         strit != alloc_seg_mpoleFiles_n.end();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;         strit++) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordtype">string</span> segName = strit-&gt;first;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordtype">string</span> filename = strit-&gt;second;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        vector&lt; PolarSite* &gt; poles = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a53f518c30b40dfa68a2278ee521af016">ParseGdmaFile</a>(filename, state);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        map_seg_polarSites[segName] = poles;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        map_seg_chrgStates[segName].resize(3);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        map_seg_chrgStates[segName][0] = <span class="keyword">false</span>; <span class="comment">// &lt;- negative</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        map_seg_chrgStates[segName][1] = <span class="keyword">true</span>;  <span class="comment">// &lt;- neutral</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        map_seg_chrgStates[segName][2] = <span class="keyword">false</span>; <span class="comment">// &lt;- positive</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        poles.clear();</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// Multipoles for negative state</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    state = -1;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> ( alloc_seg_mpoleFiles_e.size() ) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">for</span> (strit = alloc_seg_mpoleFiles_e.begin();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;             strit != alloc_seg_mpoleFiles_e.end();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;             strit++) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordtype">string</span> segName = strit-&gt;first;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordtype">string</span> filename = strit-&gt;second;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            vector&lt; PolarSite* &gt; polesAnion = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a53f518c30b40dfa68a2278ee521af016">ParseGdmaFile</a>(filename, state);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            map_seg_chrgStates[segName][state+1] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="comment">// Merge with polar sites for neutral state</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            vector&lt; PolarSite* &gt; polesNeutral = map_seg_polarSites[segName];</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            assert(polesAnion.size() == polesNeutral.size());</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; polesNeutral.size(); i++) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                polesNeutral[i]-&gt;setQs( polesAnion[i]-&gt;getQs(state), state );</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                polesNeutral[i]-&gt;setPs( polesAnion[i]-&gt;getPs(state), state );</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                <span class="keyword">delete</span> polesAnion[i];</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            polesAnion.clear();</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// Multipoles for positive state</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    state = +1;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> ( alloc_seg_mpoleFiles_h.size() ) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">for</span> (strit = alloc_seg_mpoleFiles_h.begin();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;             strit != alloc_seg_mpoleFiles_h.end();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;             strit++) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordtype">string</span> segName = strit-&gt;first;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordtype">string</span> filename = strit-&gt;second;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            vector&lt; PolarSite* &gt; polesCation = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a53f518c30b40dfa68a2278ee521af016">ParseGdmaFile</a>(filename, state);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            map_seg_chrgStates[segName][state+1] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">// Merge with polar sites for neutral state</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            vector&lt; PolarSite* &gt; polesNeutral = map_seg_polarSites[segName];</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            assert(polesCation.size() == polesNeutral.size());</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; polesNeutral.size(); i++) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                polesNeutral[i]-&gt;setQs( polesCation[i]-&gt;getQs(state), state );</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                polesNeutral[i]-&gt;setPs( polesCation[i]-&gt;getPs(state), state );</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="keyword">delete</span> polesCation[i];</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            polesCation.clear();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// Forward information on polar-site templates to topology //</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// Containers to use for mapping</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// map&lt;string, vector&lt;PolarSite*&gt; &gt;     map_seg_polarSites;</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// map&lt;string, vector&lt;int&gt; &gt;            alloc_frag_mpoleIdx;</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// map&lt;string, vector&lt;string&gt; &gt;         alloc_frag_mpoleName;</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// TO CONTINUE FROM HERE ...</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// Loop over segments, loop over fragments in segments.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// =&gt; For each segment, look up associated polar sites using map 1;</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">//      =&gt; For each fragment, look up associated</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">//         polar sites idcs. using map 2;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">//          =&gt; For each index in retrieved container, create new polar site,</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">//             importing information from polar site container of segment</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">//          =&gt; Translate positions to MD frame, copy local frame from</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">//             fragment</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a2b8beaf485e457dba14bdafece75f1eb">_map_seg_polarSites</a> = map_seg_polarSites;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#ac48f65fec2801c74eb48e39ed3520aa4">_map_seg_chrgStates</a> = map_seg_chrgStates;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#aa118e1810cefc06ebac852daee8c4023">_alloc_frag_mpoleIdx</a> =  alloc_frag_mpoleIdx;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a9255c7cd53265ac08b018aa8afba5233">_alloc_frag_mpoleName</a> = alloc_frag_mpoleName;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a53f518c30b40dfa68a2278ee521af016">  316</a></span>&#160;vector&lt;PolarSite*&gt; <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a53f518c30b40dfa68a2278ee521af016">EOutersphere::ParseGdmaFile</a>(<span class="keywordtype">string</span> filename, <span class="keywordtype">int</span> state) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">int</span> poleCount = 1;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordtype">double</span> Q0_total = 0.0;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordtype">string</span> units = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">bool</span> useDefaultPs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordtype">bool</span> warn_anisotropy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    vector&lt;PolarSite*&gt; poles;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a> *thisPole = NULL;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    vector&lt;double&gt; Qs; <span class="comment">// &lt;- multipole moments</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordtype">double</span>         P1; <span class="comment">// &lt;- dipole polarizability</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    std::string line;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    std::ifstream intt;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    intt.open(filename.c_str());</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (intt.is_open() ) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">while</span> ( intt.good() ) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <a class="code" href="namespacevotca_1_1tools.html#a7a36b45421bfaa5a38fe45a90f87c3d0" title="Wrapper for a getline function.">std::getline</a>(intt, line);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            vector&lt;string&gt; split;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> toker(line, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            toker.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#a344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>(split);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">if</span> ( !split.size()      ||</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                  split[0] == <span class="stringliteral">&quot;!&quot;</span>   ||</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                  split[0].substr(0,1) == <span class="stringliteral">&quot;!&quot;</span> ) { <span class="keywordflow">continue</span>; }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// ! Interesting information here, e.g.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// ! DCV2T opt</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// ! SP        RB3LYP          6-311+G(d,p)</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Units bohr</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// C          -4.2414603400   -3.8124751600    0.0017575736    Rank  2</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">//  -0.3853409355</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">//  -0.0002321905   0.2401559510   0.6602334308</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">//  -0.7220625314   0.0004894995  -0.0003833545   0.4526409813  -0.50937399</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">//  P 1.75</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="comment">// Units used</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">if</span> ( split[0] == <span class="stringliteral">&quot;Units&quot;</span>) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                units = split[1];</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="keywordflow">if</span> (units != <span class="stringliteral">&quot;bohr&quot;</span> &amp;&amp; units != <span class="stringliteral">&quot;angstrom&quot;</span>) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    <span class="keywordflow">throw</span> std::runtime_error( <span class="stringliteral">&quot;Unit &quot;</span> + units + <span class="stringliteral">&quot; in file &quot;</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                            + filename + <span class="stringliteral">&quot; not supported.&quot;</span>);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="comment">// element,  position,  rank limit</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( split.size() == 6 &amp;&amp; split[4] == <span class="stringliteral">&quot;Rank&quot;</span> ) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                Qs.clear();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                P1 = -1.;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <span class="keywordtype">int</span> <span class="keywordtype">id</span> = poleCount++;  <span class="comment">// &lt;- starts from 1</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordtype">string</span> name = split[0];</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <span class="keywordtype">double</span> BOHR2NM = 0.0529189379;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <span class="keywordtype">double</span> ANGSTROM2NM = 0.1;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <span class="keywordtype">double</span> <a class="code" href="linsolve_8m.html#aaeeb1ead24334ce09a1ffb542f262835">x</a>, y, z;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="keywordflow">if</span> (units == <span class="stringliteral">&quot;bohr&quot;</span>) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    x = BOHR2NM * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[1]);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    y = BOHR2NM * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[2]);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    z = BOHR2NM * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[3]);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (units == <span class="stringliteral">&quot;angstrom&quot;</span>) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                    x = ANGSTROM2NM * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[1]);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                    y = ANGSTROM2NM * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[2]);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    z = ANGSTROM2NM * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[3]);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <span class="keywordflow">throw</span> std::runtime_error( <span class="stringliteral">&quot;Unit &quot;</span> + units + <span class="stringliteral">&quot; in file &quot;</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                            + filename + <span class="stringliteral">&quot; not supported.&quot;</span>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> pos = <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a>(x,y,z);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordtype">int</span> rank = <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">int</span>&gt;(split[5]);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a> *newPole = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a>(<span class="keywordtype">id</span>, name);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                newPole-&gt;setRank(rank);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                newPole-&gt;setPos(pos);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                poles.push_back(newPole);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                thisPole = newPole;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="comment">// &#39;P&#39;, dipole polarizability</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( split[0] == <span class="stringliteral">&quot;P&quot;</span> &amp;&amp; (split.size() == 2 || split.size() == 7) ) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="keywordflow">if</span> (split.size() == 7) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    warn_anisotropy = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                P1 = 1e-3 * <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[1]);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                thisPole-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a691548e0a56cd5573db710ad8cf2e0e1">setPs</a>(P1, state);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                useDefaultPs = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="comment">// multipole line</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <span class="keywordtype">int</span> lineRank = int( sqrt(thisPole-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#adbb912519d1fbdb7ca5fe1f5d8bda7a0">getQs</a>(state).size()) + 0.5 );</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                <span class="keywordflow">if</span> (lineRank == 0) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    Q0_total += <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[0]);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; split.size(); i++) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                    <span class="keywordtype">double</span> qXYZ = <a class="code" href="namespacevotca_1_1tools.html#aa8e6d36442ef233cd3f5d59bbd640127">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(split[i]);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    <span class="comment">// Convert e*(a_0)^k to e*(nm)^k where k = rank</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    <span class="keywordtype">double</span> BOHR2NM = 0.0529189379;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    qXYZ *= pow(BOHR2NM, lineRank); <span class="comment">// OVERRIDE</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                    Qs.push_back(qXYZ);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                thisPole-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a2ed3facadcce9e92b077feb3e1d48bff">setQs</a>(Qs, state);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        } <span class="comment">/* Exit loop over lines */</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">else</span> { cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;ERROR: No such file &quot;</span> &lt;&lt; filename &lt;&lt; endl; }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... ... Reading &quot;</span> &lt;&lt; filename &lt;&lt;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                    <span class="stringliteral">&quot;: Q0(Total) = &quot;</span> &lt;&lt; Q0_total &lt;&lt; flush;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (useDefaultPs) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... ... NOTE Using default Thole polarizabilities &quot;</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;for charge state &quot;</span> &lt;&lt; state &lt;&lt; <span class="stringliteral">&quot;. &quot;</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        vector&lt; PolarSite* &gt; ::iterator pol;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">for</span> (pol = poles.begin(); pol &lt; poles.end(); ++pol) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordtype">string</span> elem = (*pol)-&gt;getName();</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordtype">double</span> alpha = 0.0;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="comment">// Original set of Thole polarizabilites</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">if</span>      (elem == <span class="stringliteral">&quot;C&quot;</span>) { alpha = 1.75e-3;  } <span class="comment">// &lt;- conversion from</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elem == <span class="stringliteral">&quot;H&quot;</span>) { alpha = 0.696e-3; } <span class="comment">//    A to nm = 10</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elem == <span class="stringliteral">&quot;N&quot;</span>) { alpha = 1.073e-3; }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elem == <span class="stringliteral">&quot;O&quot;</span>) { alpha = 0.837e-3; }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elem == <span class="stringliteral">&quot;S&quot;</span>) { alpha = 2.926e-3; }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <span class="comment">// Different set of Thole polarizabilities</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="comment">//if      (elem == &quot;C&quot;) { alpha = 1.334e-3; } // &lt;- conversion from</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="comment">//else if (elem == &quot;H&quot;) { alpha = 0.496e-3; } //    A to nm = 10</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="comment">//else if (elem == &quot;N&quot;) { alpha = 1.073e-3; }</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="comment">//else if (elem == &quot;O&quot;) { alpha = 0.837e-3; }</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="comment">//else if (elem == &quot;S&quot;) { alpha = 3.300e-3; }</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">else</span> { <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;No polarizability given &quot;</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                       <span class="stringliteral">&quot;for polar site type &quot;</span> + elem + <span class="stringliteral">&quot;. &quot;</span>); }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            (*pol)-&gt;setPs(alpha, state);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    cout &lt;&lt; endl &lt;&lt; endl</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;WARNING &#39;&quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot;&#39;: EMultipole does not support &quot;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;         &lt;&lt; <span class="stringliteral">&quot;tensorial polarizabilities, use zmultipole instead.&quot;</span> </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;         &lt;&lt; endl;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> poles;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a1e5160856b7f791ba99386e3bf746fdb">  483</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a1e5160856b7f791ba99386e3bf746fdb">EOutersphere::DistributeMpoles</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// +++++++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">// Equip TOP with distributed multipoles //</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">// +++++++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    vector&lt;Segment*&gt; ::iterator sit;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">for</span> (sit = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().begin();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;         sit &lt; top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().end();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;         ++sit) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1Segment.html">Segment</a> *seg = *sit;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        vector&lt;PolarSite*&gt; poleSites = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a2b8beaf485e457dba14bdafece75f1eb">_map_seg_polarSites</a>.at(seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>());</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#a36647683f13e577d80afae5ba590928a">setChrgStates</a>(<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#ac48f65fec2801c74eb48e39ed3520aa4">_map_seg_chrgStates</a>[seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>()]);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordtype">bool</span> map2md = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a9bb5b12d6ff277858ee1ca273d642ce7">_map2md</a>[seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>()];</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        vector&lt;Fragment*&gt; ::iterator fit;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">for</span> (fit = seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#a8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;             fit &lt; seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#a8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;             ++fit) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">Fragment</a> *frag = *fit;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordtype">string</span> idkey = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#afb2bfd5a74a05b79e478c1d9d62a5d50">getName</a>() + seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>()</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                         + seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#a599d1be171e3e9bc1b117d24057e31d9">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#a87dce0b25175392663fb3cfedb019ee6" title="Returns the name of the molecule.">getName</a>();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            vector&lt;int&gt; polesInFrag = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#aa118e1810cefc06ebac852daee8c4023">_alloc_frag_mpoleIdx</a>.at(idkey);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            vector&lt;string&gt; namesInFrag = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a9255c7cd53265ac08b018aa8afba5233">_alloc_frag_mpoleName</a>.at(idkey);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordflow">if</span> (map2md) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                <span class="keywordflow">if</span> (polesInFrag.size() != frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#a76a77f7ca04730a1cacba5533f61806f">Atoms</a>().size()) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;ERROR: Segment &quot;</span> &lt;&lt; seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>() &lt;&lt;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                            <span class="stringliteral">&quot; Fragment &quot;</span> &lt;&lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#afb2bfd5a74a05b79e478c1d9d62a5d50">getName</a>() &lt;&lt;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                            <span class="stringliteral">&quot;: MAP2MD = TRUE requires same number of polar sites &quot;</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                            <span class="stringliteral">&quot; as there are atoms to perform mapping. &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;User not paying attention. &quot;</span>);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; polesInFrag.size(); i++) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                <span class="keywordtype">string</span> name = namesInFrag[i];</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <span class="keywordtype">int</span> poleId = polesInFrag[i];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a> *templ = poleSites[poleId-1];</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a> *newSite = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#af230c74f0c53cb20a8fed1f61bd5c505">AddPolarSite</a>(name);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                newSite-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#ac3f4c7f8215fccaafd76926d96b82766">ImportFrom</a>(templ);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#ac83fd93cce7f17dcb51148804541ed77">AddPolarSite</a>(newSite);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#af6a359f1fa2dcbcaead78ceb33d893be">AddPolarSite</a>(newSite);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="comment">// Shift + rotate</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <span class="keywordflow">if</span> (!map2md) {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    newSite-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a7417e295ccdfc6e3892847c7a5e9108e">Translate</a>(frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#a61b7061ea99b9c057383e02b85329fd6">getTransQM2MD</a>());</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    newSite-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a13365a41d4c2e8c43f16b5fe10fb9034">Rotate</a>(frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#ae6a06d3180c6a09aa85265deb66953cc">getRotQM2MD</a>(), frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#ad786476992582ecba39b544cb129fe49">getCoMD</a>());</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                    <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> mdpos = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#a76a77f7ca04730a1cacba5533f61806f">Atoms</a>()[i]-&gt;getPos();</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    newSite-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a590cddabdbe9317e396f4e87be01ee25">setPos</a>(mdpos);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    <span class="keywordflow">if</span> (newSite-&gt;<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af0e4d17d409f215d0d1bebc1064ae79a">getRank</a>() &gt; 0) {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;ERROR: MAP2MD = TRUE &quot;</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                        <span class="stringliteral">&quot; prevents use of higher-rank multipoles. &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                        <span class="keywordflow">throw</span> runtime_error(<span class="stringliteral">&quot;User not paying attention. &quot;</span>);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a466fbd1bf89d4bc944c0f3a6a18c22c2">  554</a></span>&#160;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a466fbd1bf89d4bc944c0f3a6a18c22c2">EOutersphere::RequestNextPair</a>(<span class="keywordtype">int</span> opId, <a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8e829e05ace4e310d1795260161b25fc">_nextPairMutex</a>.<a class="code" href="classvotca_1_1tools_1_1Mutex.html#a82ecdca62e83a4be3bb8dadf404a48d9">Lock</a>();</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *workOnThis;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#af7061c252a6a9da852f84eafa2a4aeab">_nextPair</a> == top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a0ce372735a6cd3bacbe3cc9402d795a5">end</a>()) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        workOnThis = NULL;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        workOnThis = *<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#af7061c252a6a9da852f84eafa2a4aeab">_nextPair</a>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        ++<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#af7061c252a6a9da852f84eafa2a4aeab">_nextPair</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\r... ... OP &quot;</span> &lt;&lt; opId</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; evaluating energy for pair &quot;</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;             &lt;&lt; workOnThis-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#a24b39a974865abbf243b3a86a86601a2">getId</a>() &lt;&lt; flush;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8e829e05ace4e310d1795260161b25fc">_nextPairMutex</a>.<a class="code" href="classvotca_1_1tools_1_1Mutex.html#a98b8edeae80de9fa33f06faa55c1c053">Unlock</a>();</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> workOnThis;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a70d8abbdd754de2cb1040e5081d68dec">  577</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a70d8abbdd754de2cb1040e5081d68dec">EOutersphere::EvaluateFrame</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// ++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// Ridigidfy + Estatify //</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">// ++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">// Rigidify if (a) not rigid yet (b) rigidification at all possible</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span> (!top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a5700a8b67d7d3a9b010de448df731666">isRigid</a>()) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordtype">bool</span> isRigid = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a1473e4d37a5b875dceb107ba5445be1c">Rigidify</a>();</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span> (!isRigid) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">else</span> { cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... System is already rigidified.&quot;</span>; }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// Forward multipoles to topology</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> != <span class="stringliteral">&quot;constant&quot;</span> &amp;&amp; !top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a01c100f4b120eb1d1fde405087c3d8bb">isEStatified</a>()) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a1e5160856b7f791ba99386e3bf746fdb">DistributeMpoles</a>(top);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... Created &quot;</span> &lt;&lt; top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a0716409f2a98380391ae521b7e5d2a33">PolarSites</a>().size()</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; multipole sites.&quot;</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;constant&quot;</span>) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... Method = &#39;constant&#39; =&gt; Do not estatify.&quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... Using constant lambda = &quot;</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a35e4838a6dc6a8e87fb89edb6c01ea46">_lambdaConstant</a> &lt;&lt; flush;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">else</span> { cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;... ... System is already estatified.&quot;</span>; }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// +++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">// Create + start threads (Site Ops) //</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// +++++++++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    vector&lt;PairOpOutersphere*&gt; pairOps;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#af7061c252a6a9da852f84eafa2a4aeab">_nextPair</a> = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a777aae1be02460855d63db209b7e7cbd">begin</a>();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    cout &lt;&lt; endl;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">// Forward to first segment specified in options</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">//for ( ; (*_nextPair)-&gt;getId() != this-&gt;_firstSeg &amp;&amp;</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">//          _nextSite &lt; top-&gt;Segments().end(); ++_nextSite) { ; }</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="classvotca_1_1ctp_1_1Calculator.html#a8f7fa8dd846dfbd9026efc9bef10f9a9">_nThreads</a>; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html">PairOpOutersphere</a> *newOp = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html">PairOpOutersphere</a>(<span class="keywordtype">id</span>, top, <span class="keyword">this</span>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        pairOps.push_back(newOp);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="classvotca_1_1ctp_1_1Calculator.html#a8f7fa8dd846dfbd9026efc9bef10f9a9">_nThreads</a>; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        pairOps[id]-&gt;InitSlotData(top);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="classvotca_1_1ctp_1_1Calculator.html#a8f7fa8dd846dfbd9026efc9bef10f9a9">_nThreads</a>; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        pairOps[id]-&gt;Start();</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="classvotca_1_1ctp_1_1Calculator.html#a8f7fa8dd846dfbd9026efc9bef10f9a9">_nThreads</a>; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        pairOps[id]-&gt;WaitDone();</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="classvotca_1_1ctp_1_1Calculator.html#a8f7fa8dd846dfbd9026efc9bef10f9a9">_nThreads</a>; <span class="keywordtype">id</span>++) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keyword">delete</span> pairOps[id];</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    pairOps.clear();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">//if      (_method == &quot;constant&quot;)   { this-&gt;ConstLambda(top); }</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">//else if (_method == &quot;spheres&quot;)    { this-&gt;SpheresLambda(top);}</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">//else if (_method == &quot;dielectric&quot;) { this-&gt;DielectricLambda(top); }</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;}</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">// +++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">// PAIR OPERATOR MEMBER FUNCTS //</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">// +++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a22e3158a49d3fb422d3517feceb6c8d6">  650</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a22e3158a49d3fb422d3517feceb6c8d6">EOutersphere::PairOpOutersphere::EvalSite</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *qmpair) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;dielectric&quot;</span>) {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a3f3d771b651b2fe483ee5b6fb0dd12b9">_segsSphere</a>.clear();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aa8a2874f729f2b06b3553c5c04b4463a">_polsSphere</a>.clear();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#ae5d515181bf1df01a843f0a3674a375c">_polsPair</a>.clear();</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        vector&lt;Segment*&gt; ::iterator sit;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">for</span> (sit = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().begin(); sit &lt; top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().end(); ++sit) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <span class="comment">// TODO Introduce volume-correction when using cutoff</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="comment">//if ( abs(_top-&gt;PbShortestConnect((*sit)-&gt;getPos(), qmpair-&gt;getPos()))</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="comment">//        &gt; _master-&gt;_lambdaCutoff) { continue; }</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">if</span> ( (*sit)-&gt;getId() == qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ae3bbc86e96fd3c81901f43a4407796ea">Seg1</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#a83945ef058d7bb6efb596d04633bb497">getId</a>() ||</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                 (*sit)-&gt;getId() == qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ac57db6f8041b0af246516de6b32f6c89">Seg2</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#a83945ef058d7bb6efb596d04633bb497">getId</a>() ) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                 <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#ae5d515181bf1df01a843f0a3674a375c">_polsPair</a>.push_back( <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aa4a884f81597df13b9d5905d8bbd91d2">_polarSites</a>[(*sit)-&gt;getId() - 1] );</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a3f3d771b651b2fe483ee5b6fb0dd12b9">_segsSphere</a>.push_back(*sit);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aa8a2874f729f2b06b3553c5c04b4463a">_polsSphere</a>.push_back( <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aa4a884f81597df13b9d5905d8bbd91d2">_polarSites</a>[(*sit)-&gt;getId() - 1] );</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordtype">bool</span> hasCation = qmpair-&gt;first-&gt;hasChrgState(+1)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                      &amp;&amp; qmpair-&gt;second-&gt;hasChrgState(+1);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="keywordtype">bool</span> hasAnion  = qmpair-&gt;first-&gt;hasChrgState(-1)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                      &amp;&amp; qmpair-&gt;second-&gt;hasChrgState(-1);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">if</span> (hasCation) {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="keywordtype">int</span> state = +1;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#acb664214ab8e9dbfc986f969d624f3cd">ResetFields</a>();</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aee8f893b3846b46c4e3b7471de13682f">ChargeDeltaPair</a>(state);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="keywordtype">double</span> lOut = this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a4bbdce2d2d38ef32c289c5aa1fd2ffda">CalcOuter</a>(top, qmpair, state);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(lOut, state);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#acb664214ab8e9dbfc986f969d624f3cd">ResetFields</a>();</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">if</span> (hasAnion) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordtype">int</span> state = -1;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#acb664214ab8e9dbfc986f969d624f3cd">ResetFields</a>();</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aee8f893b3846b46c4e3b7471de13682f">ChargeDeltaPair</a>(state);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordtype">double</span> lOut = this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a4bbdce2d2d38ef32c289c5aa1fd2ffda">CalcOuter</a>(top, qmpair, state);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(lOut, state);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            this-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#acb664214ab8e9dbfc986f969d624f3cd">ResetFields</a>();</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        }        </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;constant&quot;</span>) {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordtype">bool</span> hasCation = qmpair-&gt;first-&gt;hasChrgState(+1)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                      &amp;&amp; qmpair-&gt;second-&gt;hasChrgState(+1);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordtype">bool</span> hasAnion  = qmpair-&gt;first-&gt;hasChrgState(-1)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                      &amp;&amp; qmpair-&gt;second-&gt;hasChrgState(-1);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">if</span> (hasCation) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordtype">int</span> state = +1;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordtype">double</span> lOut = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a35e4838a6dc6a8e87fb89edb6c01ea46">_lambdaConstant</a>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(lOut, state);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span> (hasAnion) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordtype">int</span> state = -1;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordtype">double</span> lOut = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a35e4838a6dc6a8e87fb89edb6c01ea46">_lambdaConstant</a>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(lOut, state);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        }  </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a5f49f88d7a6fcb3a4a9386baf2c452f9">_method</a> == <span class="stringliteral">&quot;spheres&quot;</span>) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordtype">double</span> e = 1.602176487e-19;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordtype">double</span> EPS0 = 8.85418782e-12;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordtype">double</span> NM = 1e-09;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="comment">// TODO extract radii from input</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#adad1e8c4238a0b036e01d42fa05a49fe">_radius</a>.at(<span class="stringliteral">&quot;c60&quot;</span>);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordtype">double</span> R1 = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#adad1e8c4238a0b036e01d42fa05a49fe">_radius</a>.at(qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ae3bbc86e96fd3c81901f43a4407796ea">Seg1</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>());</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordtype">double</span> R2 = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#adad1e8c4238a0b036e01d42fa05a49fe">_radius</a>.at(qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ac57db6f8041b0af246516de6b32f6c89">Seg2</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#af5a55c31af0b42d2da34ea68c833a8bd">getName</a>());</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordtype">double</span> lambda = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a8c2becaae1679cf64df678d35fcbae50">_master</a>-&gt;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8fb076fdd6fb307eac18d7b5f387b518">_pekarFactor</a> * e / (4.*M_PI*EPS0) *</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                     (  1. / ( 2.*R1*NM )</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                      + 1. / ( 2.*R2*NM )</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                      - 1. / ( qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#abfd4a9d938003e584bff7cdd2c2a304e">Dist</a>()*NM ));</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(lambda, -1);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(lambda, +1);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        assert(<span class="keyword">false</span>); <span class="comment">// No such method</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;}</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a4bbdce2d2d38ef32c289c5aa1fd2ffda">  738</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a4bbdce2d2d38ef32c289c5aa1fd2ffda">EOutersphere::PairOpOutersphere::CalcOuter</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *qmpair, <span class="keywordtype">int</span> state) {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    vector&lt; vector&lt;PolarSite*&gt; &gt; ::iterator sit1;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    vector&lt; PolarSite* &gt; ::iterator pit1;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    vector&lt; vector&lt;PolarSite*&gt; &gt; ::iterator sit2;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    vector&lt; PolarSite* &gt; ::iterator pit2;    </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordtype">double</span> dD2dV = 0.0;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordtype">double</span> int2displ = 1/(4*M_PI) * 1.602176487e-19 / 1.000e-18;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">//double int2eV   = 8.854187817e-12 *int2N_C*int2N_C /1.602176487e-19;</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">int</span> polCount = 0;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">for</span> (sit1 = _polsSphere.begin(); sit1 &lt; _polsSphere.end(); ++sit1) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">for</span> (pit1 = (*sit1).begin(); pit1 &lt; (*sit1).end(); ++pit1) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        ++polCount;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">for</span> (sit2 = _polsPair.begin(); sit2 &lt; _polsPair.end(); ++sit2) {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">for</span> (pit2 = (*sit2).begin(); pit2 &lt; (*sit2).end(); ++pit2) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        this-&gt;_actor.Field_AT_DUE(*(*pit1), *(*pit2));</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }}</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        dD2dV += (*pit1)-&gt;FPx * (*pit1)-&gt;FPx +</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                 (*pit1)-&gt;FPy * (*pit1)-&gt;FPy +</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                 (*pit1)-&gt;FPz * (*pit1)-&gt;FPz;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    }}</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    dD2dV *= int2displ * int2displ;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">return</span> 0.5 * _master-&gt;_pekarFactor/8.854187817e-12</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;               * top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a0a1cf18bdbb151f830f26a3dc5a12a22">BoxVolume</a>()*1.000e-27/top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a0716409f2a98380391ae521b7e5d2a33">PolarSites</a>().size()</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;               * dD2dV /1.602176487e-19;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;}</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aee8f893b3846b46c4e3b7471de13682f">  776</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#aee8f893b3846b46c4e3b7471de13682f">EOutersphere::PairOpOutersphere::ChargeDeltaPair</a>(<span class="keywordtype">int</span> state) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    vector&lt; vector&lt;PolarSite*&gt; &gt; ::iterator sit;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    vector&lt; PolarSite* &gt; ::iterator pit;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    sit = _polsPair.begin();</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">for</span> (pit = (*sit).begin(); pit &lt; (*sit).end(); ++pit) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        (*pit)-&gt;ChargeDelta(state, 0);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    ++sit;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">for</span> (pit = (*sit).begin(); pit &lt; (*sit).end(); ++pit) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        (*pit)-&gt;ChargeDelta(0, state);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#acb664214ab8e9dbfc986f969d624f3cd">  795</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#acb664214ab8e9dbfc986f969d624f3cd">EOutersphere::PairOpOutersphere::ResetFields</a>() {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    vector&lt; vector&lt;PolarSite*&gt; &gt; ::iterator sit;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    vector&lt; PolarSite* &gt; ::iterator pit;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">for</span> (sit = _polsSphere.begin(); sit &lt; _polsSphere.end(); ++sit) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">for</span> (pit = (*sit).begin(); pit &lt; (*sit).end(); ++pit) {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            (*pit)-&gt;ResetFieldP();</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a2dd6c6bda3d53e90b06c0afd8b0a522e">  808</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a2dd6c6bda3d53e90b06c0afd8b0a522e" title="Run() executes the actual code. Overload it.">EOutersphere::PairOpOutersphere::Run</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        _pair = _master-&gt;RequestNextPair(_id, _top);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="keywordflow">if</span> (_pair == NULL) { <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">else</span> { this-&gt;EvalSite(_top, _pair); }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;}</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div>
<div class="line"><a name="l00820"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a707e299e5cb56331571b94485d8fdb11">  820</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a707e299e5cb56331571b94485d8fdb11">EOutersphere::PairOpOutersphere::InitSlotData</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    vector&lt; Segment* &gt; ::iterator sitRef;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    vector&lt; vector&lt;PolarSite*&gt; &gt; ::iterator sitNew;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    vector&lt; PolarSite* &gt; ::iterator pitRef;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    vector&lt; PolarSite* &gt; ::iterator pitNew;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    _polarSites.resize(top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().size());</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    assert(top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().size() == _polarSites.size());</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">for</span> (sitRef = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().begin(), sitNew = _polarSites.begin();</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;         sitRef &lt; top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().end();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;         ++sitRef, ++sitNew) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        (*sitNew).resize((*sitRef)-&gt;PolarSites().size());</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">for</span> (pitRef = (*sitRef)-&gt;PolarSites().begin(),</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;             pitNew = (*sitNew).begin();</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;             pitRef &lt; (*sitRef)-&gt;PolarSites().end();</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;             ++pitRef, ++ pitNew) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            *pitNew = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a>();</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            (*pitNew)-&gt;ImportFrom(*pitRef, <span class="stringliteral">&quot;full&quot;</span>);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            (*pitNew)-&gt;Charge(0);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    }</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a9b4ec1fec3748ce3efd4d3335f340a5f">  849</a></span>&#160;<a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1PairOpOutersphere.html#a9b4ec1fec3748ce3efd4d3335f340a5f">EOutersphere::PairOpOutersphere::~PairOpOutersphere</a>() {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    vector&lt; vector&lt;PolarSite*&gt; &gt; ::iterator sit;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    vector&lt;PolarSite*&gt; ::iterator pol;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">for</span> (sit = _polarSites.begin(); sit &lt; _polarSites.end(); ++sit) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">for</span> (pol = (*sit).begin(); pol &lt; (*sit).end(); ++pol) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keyword">delete</span> *pol;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        (*sit).clear();</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    _polarSites.clear();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;}</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">// +++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">// CHEAPER METHODS (DISCARDED) //</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">// +++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a207f0467acb8d7f35adf7ef69ba902d5">  868</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a207f0467acb8d7f35adf7ef69ba902d5">EOutersphere::ConstLambda</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="classvotca_1_1csg_1_1PairList.html#a8341cf06ea420f03dcb5160119278a8a">QMNBList ::iterator</a> pit;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">for</span> (pit = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a777aae1be02460855d63db209b7e7cbd">begin</a>(); pit != top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a0ce372735a6cd3bacbe3cc9402d795a5">end</a>(); pit++) {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *qpair = *pit;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        qpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a35e4838a6dc6a8e87fb89edb6c01ea46">_lambdaConstant</a>, -1);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        qpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ad285e68a8e42d3415f1abafe763b076a">setLambdaO</a>(<a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a35e4838a6dc6a8e87fb89edb6c01ea46">_lambdaConstant</a>, +1);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a7de772cb98877644eeb6a2feedb43eff">  879</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a7de772cb98877644eeb6a2feedb43eff">EOutersphere::SpheresLambda</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordtype">double</span> e = 1.602176487e-19;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordtype">double</span> EPS0 = 8.85418782e-12;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordtype">double</span> NM = 1e-09;    </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <a class="code" href="classvotca_1_1csg_1_1PairList.html#a8341cf06ea420f03dcb5160119278a8a">QMNBList ::iterator</a> pit;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">for</span> (pit = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a777aae1be02460855d63db209b7e7cbd">begin</a>(); pit != top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a0ce372735a6cd3bacbe3cc9402d795a5">end</a>(); pit++) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair = *pit;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="comment">// TODO extract radii from input</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot; EOutersphere -&gt; Need to read in radii&quot;</span>);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordtype">double</span> R1 = 1;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordtype">double</span> R2 = 2;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordtype">double</span> lambda = <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8fb076fdd6fb307eac18d7b5f387b518">_pekarFactor</a> * e / (4.*M_PI*EPS0) *</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                     (  1. / ( 2.*R1*NM )</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                      + 1. / ( 2.*R2*NM )</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                      - 1. / ( pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#abfd4a9d938003e584bff7cdd2c2a304e">Dist</a>()*NM ));</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        assert (<span class="keyword">false</span>); <span class="comment">// TODO e, h calc. // pair-&gt;setLambdaO(lambda);</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#ac5bd39d55eb5966b594652eeb64a488c">  902</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#ac5bd39d55eb5966b594652eeb64a488c">EOutersphere::DielectricLambda</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top) {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordtype">double</span> e = 1.602176487e-19;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordtype">double</span> EPS0 = 8.85418782e-12;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordtype">double</span> NM = 1.e-09;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordtype">double</span> NM3 = 1.e-27;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <a class="code" href="classvotca_1_1csg_1_1PairList.html#a8341cf06ea420f03dcb5160119278a8a">QMNBList ::iterator</a> pit;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">for</span> (pit = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a777aae1be02460855d63db209b7e7cbd">begin</a>(); pit != top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac546b928e29e690be03b3f273e9e2d05">NBList</a>().<a class="code" href="classvotca_1_1csg_1_1PairList.html#a0ce372735a6cd3bacbe3cc9402d795a5">end</a>(); pit++) {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair = *pit;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordtype">double</span> lambda = 0.;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> seg1pos = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ae3bbc86e96fd3c81901f43a4407796ea">Seg1</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#aa05429e4714e6037f0f088cd1db92f2c">getPos</a>();</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> seg2pos = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ac57db6f8041b0af246516de6b32f6c89">Seg2</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#aa05429e4714e6037f0f088cd1db92f2c">getPos</a>();</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        vector&lt; Segment* &gt; ::iterator sit;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">for</span> (sit = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().begin();</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;             sit &lt; top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().end();</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;             sit++) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;             <a class="code" href="classvotca_1_1ctp_1_1Segment.html">Segment</a> *seg = *sit;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;             <span class="comment">// Segment external to pair? Cut-off obeyed?</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;             <span class="keywordflow">if</span> ( seg == pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ae3bbc86e96fd3c81901f43a4407796ea">Seg1</a>() || seg == pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ac57db6f8041b0af246516de6b32f6c89">Seg2</a>() ) { <span class="keywordflow">continue</span>; }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> dR1bc = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ae6c69da238b2a0f697ccfa8f46298915">PbShortestConnect</a>( seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#aa05429e4714e6037f0f088cd1db92f2c">getPos</a>(), seg1pos );</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> dR2bc = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ae6c69da238b2a0f697ccfa8f46298915">PbShortestConnect</a>( seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#aa05429e4714e6037f0f088cd1db92f2c">getPos</a>(), seg2pos );</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;             <span class="keywordflow">if</span> ( <a class="code" href="namespacevotca_1_1tools.html#abc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>( (dR1bc+dR2bc)*0.5 ) &gt; <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#aa545b1397aeb7d0e062b4b1e00d93e5d">_lambdaCutoff</a> ) { <span class="keywordflow">continue</span>; }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> dR1   = seg1pos - seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#aa05429e4714e6037f0f088cd1db92f2c">getPos</a>();</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> dR2   = seg2pos - seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#aa05429e4714e6037f0f088cd1db92f2c">getPos</a>();</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> shift1 = dR1bc - dR1;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> shift2 = dR2bc - dR2;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;             vector&lt; Atom* &gt; ::iterator ait;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;             vector&lt; Atom* &gt; ::iterator bit;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;             <span class="keywordflow">for</span> (ait = seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#afed929e4f8d26feb147ddc275f780e4f">Atoms</a>().begin(); ait &lt; seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#afed929e4f8d26feb147ddc275f780e4f">Atoms</a>().end(); ait++) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                 <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">Atom</a> *Ext = *ait;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                 <span class="comment">// Electric induction field</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                 <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> D = <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a>(0.,0.,0.);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                 <span class="keywordflow">for</span> (bit = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ae3bbc86e96fd3c81901f43a4407796ea">Seg1</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#afed929e4f8d26feb147ddc275f780e4f">Atoms</a>().begin();</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                         bit &lt; pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ae3bbc86e96fd3c81901f43a4407796ea">Seg1</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#afed929e4f8d26feb147ddc275f780e4f">Atoms</a>().end();</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                         bit++) {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                     <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">Atom</a> *Int = *bit;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                     </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                     <span class="keywordtype">double</span> dQ = Int-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aa10d3510dd7891d535f5c1cdfc06350b">getQ</a>(-1) - Int-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aa10d3510dd7891d535f5c1cdfc06350b">getQ</a>(0);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                     </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                     <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> R = Ext-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aeaaedc427b46cab7d6325c68eb75770e">getPos</a>() - Int-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aeaaedc427b46cab7d6325c68eb75770e">getPos</a>() - shift1;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                     <span class="keywordtype">double</span> dr = <a class="code" href="namespacevotca_1_1tools.html#abc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(R);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                     <span class="keywordtype">double</span> dr3 = dr*dr*dr;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                     D += e * dQ / (4.*M_PI*dr3*NM3) * R * NM;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                 }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                 <span class="keywordflow">for</span> (bit = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ac57db6f8041b0af246516de6b32f6c89">Seg2</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#afed929e4f8d26feb147ddc275f780e4f">Atoms</a>().begin();</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                         bit &lt; pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ac57db6f8041b0af246516de6b32f6c89">Seg2</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#afed929e4f8d26feb147ddc275f780e4f">Atoms</a>().end();</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                         bit++) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                     <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">Atom</a> *Int = *bit;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                     <span class="keywordtype">double</span> dQ = Int-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aa10d3510dd7891d535f5c1cdfc06350b">getQ</a>(0) - Int-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aa10d3510dd7891d535f5c1cdfc06350b">getQ</a>(-1);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                     </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                     <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> R = Ext-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aeaaedc427b46cab7d6325c68eb75770e">getPos</a>() - Int-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#aeaaedc427b46cab7d6325c68eb75770e">getPos</a>() - shift2;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                     <span class="keywordtype">double</span> dr = <a class="code" href="namespacevotca_1_1tools.html#abc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(R);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                     <span class="keywordtype">double</span> dr3 = dr*dr*dr;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                     D += e * dQ / (4.*M_PI*dr3*NM3) * R * NM;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                 }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                 </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                 lambda += 1/e * <a class="code" href="classvotca_1_1ctp_1_1EOutersphere.html#a8fb076fdd6fb307eac18d7b5f387b518">_pekarFactor</a>/(2*EPS0)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                         * top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a0a1cf18bdbb151f830f26a3dc5a12a22">BoxVolume</a>()*NM3 / top-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a5a9b8b9c2dd45afdd451ffb2fce21ed8">Atoms</a>().size();   </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;             } <span class="comment">/* exit loop over external atoms in segment */</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        } <span class="comment">/* exit loop over external segments */</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        assert (<span class="keyword">false</span>); <span class="comment">// TODO e, h calculation // pair-&gt;setLambdaO(lambda);</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    } <span class="comment">/* exit loop over pairs */</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;}</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">// +++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">// INTERACTOR MEMBER FUNCTIONS //</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">// +++++++++++++++++++++++++++ //</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno"><a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1InteractorMod.html#ab553b9a364aa91e2f9a4d871197c62ed">  990</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1EOutersphere_1_1InteractorMod.html#ab553b9a364aa91e2f9a4d871197c62ed">EOutersphere::InteractorMod::Field_AT_DUE</a>(<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a> &amp;pol1, <a class="code" href="classvotca_1_1ctp_1_1PolarSite.html">PolarSite</a> &amp;pol) {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">// NOTE &gt;&gt;&gt; e12 points from polar site 1 to polar site 2 &lt;&lt;&lt; NOTE //</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    e12  = _top-&gt;PbShortestConnect(pol1.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af4bd93a5d01316e90554dad1aff74a07">getPos</a>(), pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af4bd93a5d01316e90554dad1aff74a07">getPos</a>());</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    R    = 1/<a class="code" href="namespacevotca_1_1tools.html#abc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(e12);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    R2   = R*R;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    R3   = R2*R;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    R4   = R3*R;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    R5   = R4*R;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    e12 *= R;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        rax = e12.getX();</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        ray = e12.getY();</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        raz = e12.getZ();</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        rbx = - rax;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        rby = - ray;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        rbz = - raz;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        cxx = 1;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        cxy = 0;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        cxz = 0;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        cyx = 0;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        cyy = 1;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        cyz = 0;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        czx = 0;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        czy = 0;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        czz = 1;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordtype">double</span> Fx = 0.0;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordtype">double</span> Fy = 0.0;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordtype">double</span> Fz = 0.0;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// Field generated by rank-0 m&#39;pole</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        Fx += T1x_00() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af88fc844600e960466a85a2d774d8280">Q00</a>;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        Fy += T1y_00() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af88fc844600e960466a85a2d774d8280">Q00</a>;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        Fz += T1z_00() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af88fc844600e960466a85a2d774d8280">Q00</a>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="comment">// Field generated by rank-1 m&#39;pole</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">if</span> (pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a16e4880d23f5d8bfd3fe343fec429beb">_rank</a> &gt; 0) {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        Fx += T1x_1x() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a27cf0c24a3286c9df60f8dc3ddea6172">Q1x</a>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        Fx += T1x_1y() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a3f415bc6c49c0714fd7aaa90163232fa">Q1y</a>;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        Fx += T1x_1z() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#acae7ecf96018060518fdad2d399a2186">Q1z</a>;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        Fy += T1y_1x() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a27cf0c24a3286c9df60f8dc3ddea6172">Q1x</a>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        Fy += T1y_1y() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a3f415bc6c49c0714fd7aaa90163232fa">Q1y</a>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        Fy += T1y_1z() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#acae7ecf96018060518fdad2d399a2186">Q1z</a>;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        Fz += T1z_1x() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a27cf0c24a3286c9df60f8dc3ddea6172">Q1x</a>;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        Fz += T1z_1y() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a3f415bc6c49c0714fd7aaa90163232fa">Q1y</a>;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        Fz += T1z_1z() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#acae7ecf96018060518fdad2d399a2186">Q1z</a>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="comment">// Field generated by rank-2 m&#39;pole</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">if</span> (pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a16e4880d23f5d8bfd3fe343fec429beb">_rank</a> &gt; 1) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        Fx += T1x_20()  * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#aec257db329c3d5678b9c7a3a4f290430">Q20</a>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        Fx += T1x_21c() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#aef5209f34f4337c3eb6817b322af5a37">Q21c</a>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        Fx += T1x_21s() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a06ffa6fb7036cdbf4e90d1e62e503881">Q21s</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        Fx += T1x_22c() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a58a963a51e954f9ca24c86c285a00dde">Q22c</a>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        Fx += T1x_22s() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a0931d00586c27abf953bd91f14858208">Q22s</a>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        Fy += T1y_20()  * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#aec257db329c3d5678b9c7a3a4f290430">Q20</a>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        Fy += T1y_21c() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#aef5209f34f4337c3eb6817b322af5a37">Q21c</a>;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        Fy += T1y_21s() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a06ffa6fb7036cdbf4e90d1e62e503881">Q21s</a>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        Fy += T1y_22c() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a58a963a51e954f9ca24c86c285a00dde">Q22c</a>;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        Fy += T1y_22s() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a0931d00586c27abf953bd91f14858208">Q22s</a>;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        Fz += T1z_20()  * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#aec257db329c3d5678b9c7a3a4f290430">Q20</a>;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        Fz += T1z_21c() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#aef5209f34f4337c3eb6817b322af5a37">Q21c</a>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        Fz += T1z_21s() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a06ffa6fb7036cdbf4e90d1e62e503881">Q21s</a>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        Fz += T1z_22c() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a58a963a51e954f9ca24c86c285a00dde">Q22c</a>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        Fz += T1z_22s() * pol.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a0931d00586c27abf953bd91f14858208">Q22s</a>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    pol1.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#af929b7a8a793a0b98e3a5e141d6973f3">FPx</a> += Fx;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    pol1.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#a746974fec9f390b89e1cc237385c32c0">FPy</a> += Fy;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    pol1.<a class="code" href="classvotca_1_1ctp_1_1PolarSite.html#ada3be68d52a1b93adfc8de31a86f2b2e">FPz</a> += Fz;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;}</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}}</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
