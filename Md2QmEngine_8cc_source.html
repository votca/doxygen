<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Votca: ctp/src/tools/Md2QmEngine.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ctp/src/tools/Md2QmEngine.cc</h1><a href="Md2QmEngine_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="Md2QmEngine_8h.html">Md2QmEngine.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;<a class="code" href="boundarycondition_8h.html">votca/csg/boundarycondition.h</a>&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;<a class="code" href="globals_8h.html">votca/tools/globals.h</a>&gt;</span>
<a name="l00004"></a>00004 
<a name="l00008"></a><a class="code" href="classMd2QmEngine.html#74a930c19254a6e04363a234c5f774d9">00008</a> <a class="code" href="classMd2QmEngine.html#74a930c19254a6e04363a234c5f774d9">Md2QmEngine::~Md2QmEngine</a>() {
<a name="l00009"></a>00009 
<a name="l00010"></a>00010     vector &lt; CTP::Molecule* &gt; :: iterator molecule;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012     <span class="comment">// Clean up list of molecule types</span>
<a name="l00013"></a>00013     <span class="keywordflow">for</span> (molecule = <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.begin();
<a name="l00014"></a>00014          molecule &lt; <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.end(); ++molecule){
<a name="l00015"></a>00015          <span class="keyword">delete</span> *molecule;
<a name="l00016"></a>00016     }
<a name="l00017"></a>00017     <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.clear();
<a name="l00018"></a>00018 
<a name="l00019"></a>00019     <span class="comment">// clean up maps</span>
<a name="l00020"></a>00020     <a class="code" href="classMd2QmEngine.html#8b5a1ede0b6bb8d6e86fdf7e0059540d">_map_MoleculeName_MoleculeType</a>.clear();
<a name="l00021"></a>00021     <a class="code" href="classMd2QmEngine.html#c05ddc9a77ff9b96f84c2db46df80360">_map_MoleculeMDName_MoleculeName</a>.clear();
<a name="l00022"></a>00022 }
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00032"></a><a class="code" href="classMd2QmEngine.html#d27fcef7cf0558671a834524a077a3de">00032</a> <span class="keywordtype">void</span> <a class="code" href="classMd2QmEngine.html#d27fcef7cf0558671a834524a077a3de">Md2QmEngine::Initialize</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;xmlfile) {
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> typology;
<a name="l00035"></a>00035     <a class="code" href="namespacevotca_1_1tools.html#f135f0aaaac442ad3d3285a3b1d539b7">load_property_from_xml</a>(typology, xmlfile.c_str());
<a name="l00036"></a>00036 
<a name="l00037"></a>00037     <span class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00038"></a>00038     <span class="comment">// XML to Types: Molecules =&gt; Segments =&gt; Fragments =&gt; Atoms //</span>
<a name="l00039"></a>00039     <span class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041     <span class="keywordtype">string</span> key = <span class="stringliteral">"topology.molecules.molecule"</span>;
<a name="l00042"></a>00042     list&lt;Property *&gt; molecules = typology.<a class="code" href="classvotca_1_1tools_1_1Property.html#d7987d4a19543a46ca8d38dd8b26121a" title="select property based on a filter">Select</a>(key);
<a name="l00043"></a>00043     list&lt;Property *&gt;::iterator it_molecule;
<a name="l00044"></a>00044     <span class="keywordtype">int</span> molecule_id = 1;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="keywordflow">for</span> ( it_molecule = molecules.begin();
<a name="l00047"></a>00047           it_molecule != molecules.end();
<a name="l00048"></a>00048           ++it_molecule ) {
<a name="l00049"></a>00049 
<a name="l00050"></a>00050        <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *molecule = <a class="code" href="classMd2QmEngine.html#3afd4d79a70ec66396fc7dfb8fb71ced">AddMoleculeType</a>(molecule_id++, *it_molecule);
<a name="l00051"></a>00051        <span class="keywordtype">string</span> molMdName = (*it_molecule)-&gt;get(<span class="stringliteral">"mdname"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00052"></a>00052 
<a name="l00053"></a>00053        <span class="comment">// +++++++++++++ //</span>
<a name="l00054"></a>00054        <span class="comment">// Load segments //</span>
<a name="l00055"></a>00055        <span class="comment">// +++++++++++++ //</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057        key = <span class="stringliteral">"segments.segment"</span>;
<a name="l00058"></a>00058        list&lt;Property *&gt; segments = (*it_molecule)-&gt;Select(key);
<a name="l00059"></a>00059        list&lt;Property *&gt;::iterator it_segment;
<a name="l00060"></a>00060        <span class="keywordtype">int</span> segment_id = 1;
<a name="l00061"></a>00061        <span class="keywordtype">int</span> qmunit_id  = 1;
<a name="l00062"></a>00062        <span class="keywordtype">int</span> md_atom_id = 1; <span class="comment">// &lt;- atom id count with respect to molecule</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064        <span class="keywordflow">for</span> ( it_segment = segments.begin();
<a name="l00065"></a>00065              it_segment != segments.end();
<a name="l00066"></a>00066              ++it_segment ) {
<a name="l00067"></a>00067 
<a name="l00068"></a>00068          <span class="comment">// Create new segment + associated type (QM Unit)</span>
<a name="l00069"></a>00069          <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a> *segment = <a class="code" href="classMd2QmEngine.html#afbf87d1af3326b588d4c75b240f0275">AddSegmentType</a>(segment_id++, *it_segment );
<a name="l00070"></a>00070          <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">CTP::SegmentType</a> *qmUnit = <a class="code" href="classMd2QmEngine.html#6374e5cc4c741376436ace928e0caf9b">AddQMUnit</a>(qmunit_id, *it_segment );
<a name="l00071"></a>00071          segment-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f8b60aaed29fd6dd25db47bebb74b01b">setType</a>(qmUnit);
<a name="l00072"></a>00072          molecule-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#b075d2195d8919218a67a655c51a3c82">AddSegment</a>(segment);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074          <span class="comment">// Load internal (i.e. QM-) coord.s and MOO-related properties</span>
<a name="l00075"></a>00075          <span class="keywordtype">string</span> qmcoordsFile = <span class="stringliteral">""</span>;
<a name="l00076"></a>00076          map&lt;int, pair&lt;string, vec&gt; &gt; intCoords;
<a name="l00077"></a>00077          <span class="keywordflow">if</span> ( (*it_segment)-&gt;exists(<span class="stringliteral">"qmcoords"</span>) ) {
<a name="l00078"></a>00078             qmcoordsFile = (*it_segment)-&gt;get(<span class="stringliteral">"qmcoords"</span>).as&lt;<span class="keywordtype">string</span>&gt;();            
<a name="l00079"></a>00079             <span class="comment">//  QM ID    Element   Position</span>
<a name="l00080"></a>00080             this-&gt;<a class="code" href="classMd2QmEngine.html#94a78b1c5e6f84fd97530863cd8f8925">getIntCoords</a>(qmcoordsFile, intCoords);
<a name="l00081"></a>00081          }
<a name="l00082"></a>00082          
<a name="l00083"></a>00083          <span class="comment">// ++++++++++++++ //</span>
<a name="l00084"></a>00084          <span class="comment">// Load fragments //</span>
<a name="l00085"></a>00085          <span class="comment">// ++++++++++++++ //</span>
<a name="l00086"></a>00086 
<a name="l00087"></a>00087          key = <span class="stringliteral">"fragments.fragment"</span>;
<a name="l00088"></a>00088          list&lt;Property *&gt; fragments = (*it_segment)-&gt;Select(key);
<a name="l00089"></a>00089          list&lt;Property *&gt;::iterator it_fragment;
<a name="l00090"></a>00090          <span class="keywordtype">int</span> fragment_id = 1;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092          <span class="keywordflow">for</span> ( it_fragment = fragments.begin();
<a name="l00093"></a>00093                it_fragment != fragments.end();
<a name="l00094"></a>00094                ++it_fragment ) {
<a name="l00095"></a>00095 
<a name="l00096"></a>00096             <span class="comment">// Create new fragment</span>
<a name="l00097"></a>00097             <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a>* fragment=<a class="code" href="classMd2QmEngine.html#86781454995f772d738f0670ac0e030a">AddFragmentType</a>(fragment_id++,*it_fragment);
<a name="l00098"></a>00098             segment-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f96d1b8363630b002e5a1768f31d16a1">AddFragment</a>( fragment );
<a name="l00099"></a>00099 
<a name="l00100"></a>00100             <span class="comment">// Load local-frame definition</span>
<a name="l00101"></a>00101             vector&lt;int&gt; trihedron = (*it_fragment)-&gt;get(<span class="stringliteral">"localframe"</span>)
<a name="l00102"></a>00102                                                 .as&lt; vector&lt;int&gt; &gt;();
<a name="l00103"></a>00103             <span class="keywordflow">while</span> (trihedron.size() &lt; 3) {
<a name="l00104"></a>00104                 trihedron.push_back(-1);
<a name="l00105"></a>00105             }
<a name="l00106"></a>00106             fragment-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#3aa974a0a07ae970691a2fe0cab7a69c">setTrihedron</a>(trihedron);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00109"></a>00109              <span class="comment">// ++++++++++ //</span>
<a name="l00110"></a>00110              <span class="comment">// Load atoms //</span>
<a name="l00111"></a>00111              <span class="comment">// ++++++++++ //</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113              <span class="keywordtype">string</span> mdatoms = (*it_fragment)-&gt;get(<span class="stringliteral">"mdatoms"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00114"></a>00114              <span class="keywordtype">string</span> qmatoms = (*it_fragment)-&gt;get(<span class="stringliteral">"qmatoms"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00115"></a>00115              <span class="keywordtype">string</span> weights = (*it_fragment)-&gt;get(<span class="stringliteral">"weights"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00116"></a>00116 
<a name="l00117"></a>00117              <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tok_md_atoms(mdatoms, <span class="stringliteral">" \t\n"</span>);
<a name="l00118"></a>00118              <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tok_qm_atoms(qmatoms, <span class="stringliteral">" \t\n"</span>);
<a name="l00119"></a>00119              <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tok_weights(weights, <span class="stringliteral">" \t\n"</span>);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121              vector &lt;string&gt; md_atoms_info;
<a name="l00122"></a>00122              vector &lt;string&gt; qm_atoms_info;
<a name="l00123"></a>00123              vector &lt;string&gt; atom_weights;;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125              tok_md_atoms.ToVector(md_atoms_info);
<a name="l00126"></a>00126              tok_qm_atoms.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>(qm_atoms_info);
<a name="l00127"></a>00127              tok_weights.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>(atom_weights);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129              <span class="comment">//assert(md_atoms_info.size() == qm_atoms_info.size());</span>
<a name="l00130"></a>00130              <span class="comment">//assert(md_atoms_info.size() == atom_weights.size());</span>
<a name="l00131"></a>00131 
<a name="l00132"></a>00132              <span class="keywordflow">if</span> ( (md_atoms_info.size() != qm_atoms_info.size()) ||
<a name="l00133"></a>00133                   (md_atoms_info.size() != atom_weights.size() ) ) {
<a name="l00134"></a>00134                  cout &lt;&lt; <span class="stringliteral">"ERROR: "</span>
<a name="l00135"></a>00135                       &lt;&lt; <span class="stringliteral">"Could not allocate MD atoms to QM atoms or weights"</span>
<a name="l00136"></a>00136                       &lt;&lt; <span class="stringliteral">" in segment "</span> &lt;&lt; segment-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f5a55c31af0b42d2da34ea68c833a8bd">getName</a>()
<a name="l00137"></a>00137                       &lt;&lt; <span class="stringliteral">" in molecule "</span> &lt;&lt; molMdName
<a name="l00138"></a>00138                       &lt;&lt; <span class="stringliteral">" due to inconsistent number of columns."</span>
<a name="l00139"></a>00139                       &lt;&lt; endl;
<a name="l00140"></a>00140                  cout &lt;&lt; <span class="stringliteral">"NOTE: "</span>
<a name="l00141"></a>00141                       &lt;&lt; <span class="stringliteral">"To define an MD atom without QM counterpart, insert "</span>
<a name="l00142"></a>00142                       &lt;&lt; <span class="stringliteral">"a single ':' in the associated QM-atoms column and "</span>
<a name="l00143"></a>00143                       &lt;&lt; <span class="stringliteral">"specify a mapping weight of 0."</span>
<a name="l00144"></a>00144                       &lt;&lt; endl;
<a name="l00145"></a>00145                  <span class="keywordflow">throw</span> runtime_error( <span class="stringliteral">"Inconsistency in mapping file."</span> );
<a name="l00146"></a>00146              }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148              vector&lt;string&gt; ::iterator it_md_atom_name;
<a name="l00149"></a>00149              vector&lt;string&gt; ::iterator it_qm_atom_name;
<a name="l00150"></a>00150              vector&lt;string&gt; ::iterator it_atom_weight;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152              <span class="keywordflow">for</span> ( it_md_atom_name = md_atoms_info.begin(),
<a name="l00153"></a>00153                    it_qm_atom_name = qm_atoms_info.begin(),
<a name="l00154"></a>00154                    it_atom_weight  = atom_weights.begin();
<a name="l00155"></a>00155                    it_md_atom_name != md_atoms_info.end();
<a name="l00156"></a>00156                    ++it_md_atom_name,
<a name="l00157"></a>00157                    ++it_qm_atom_name,
<a name="l00158"></a>00158                    ++ it_atom_weight) {
<a name="l00159"></a>00159 
<a name="l00160"></a>00160                <span class="comment">// ++++++++++++++++++ //</span>
<a name="l00161"></a>00161                <span class="comment">// Create single atom //</span>
<a name="l00162"></a>00162                <span class="comment">// ++++++++++++++++++ //</span>
<a name="l00163"></a>00163 
<a name="l00164"></a>00164                <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tok_md((*it_md_atom_name), <span class="stringliteral">":"</span>);
<a name="l00165"></a>00165                <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> tok_qm((*it_qm_atom_name), <span class="stringliteral">":"</span>);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167                vector&lt;string&gt; md_atom_specs;
<a name="l00168"></a>00168                vector&lt;string&gt; qm_atom_specs;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170                tok_md.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>( md_atom_specs );
<a name="l00171"></a>00171                tok_qm.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>( qm_atom_specs );
<a name="l00172"></a>00172 
<a name="l00173"></a>00173                <span class="comment">// MD atom information</span>
<a name="l00174"></a>00174                <span class="keywordtype">int</span> residue_number  = <a class="code" href="namespacevotca_1_1tools.html#9530f61e1349b569382075f9e63a4fa6">boost::lexical_cast</a>&lt;<span class="keywordtype">int</span>&gt;(md_atom_specs[0]);
<a name="l00175"></a>00175                <span class="keywordtype">string</span> residue_name = md_atom_specs[1];
<a name="l00176"></a>00176                <span class="keywordtype">string</span> md_atom_name = md_atom_specs[2];
<a name="l00177"></a>00177                
<a name="l00178"></a>00178                <span class="comment">// QM atom information</span>
<a name="l00179"></a>00179                <span class="keywordtype">bool</span> hasQMPart = <span class="keyword">false</span>;
<a name="l00180"></a>00180                <span class="keywordtype">int</span> qm_atom_id = -1;
<a name="l00181"></a>00181                <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> qmPos = <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a>(0,0,0);
<a name="l00182"></a>00182                <span class="comment">// The atomic element is first taken as first character of</span>
<a name="l00183"></a>00183                <span class="comment">// the MD name; for atoms with QM counterpart, the element</span>
<a name="l00184"></a>00184                <span class="comment">// is read from the coordinates file</span>
<a name="l00185"></a>00185                <span class="keywordtype">string</span> element = md_atom_name.substr(0,1);
<a name="l00186"></a>00186                <span class="comment">// Check whether MD atom has QM counterpart</span>
<a name="l00187"></a>00187                <span class="keywordflow">if</span> (qm_atom_specs.size() == 2) {
<a name="l00188"></a>00188                    hasQMPart = <span class="keyword">true</span>;
<a name="l00189"></a>00189                    qm_atom_id = <a class="code" href="namespacevotca_1_1tools.html#9530f61e1349b569382075f9e63a4fa6">boost::lexical_cast</a>&lt;<span class="keywordtype">int</span>&gt;(qm_atom_specs[0]);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191                    <span class="comment">// Look up qm coordinates in table created from xyz file</span>
<a name="l00192"></a>00192                    <span class="keywordflow">try</span> {
<a name="l00193"></a>00193                        qmPos = intCoords.at(qm_atom_id).second;
<a name="l00194"></a>00194                        element = intCoords.at(qm_atom_id).first;
<a name="l00195"></a>00195                        <span class="comment">// Check whether elements of md and qm match</span>
<a name="l00196"></a>00196                        <span class="keywordflow">if</span> (intCoords.at(qm_atom_id).first
<a name="l00197"></a>00197                            != md_atom_name.substr(0,1) ) {
<a name="l00198"></a>00198                            cout &lt;&lt; <span class="stringliteral">"WARNING: Atom "</span> &lt;&lt;md_atom_name &lt;&lt; <span class="stringliteral">"in mol. "</span>
<a name="l00199"></a>00199                                 &lt;&lt; molMdName &lt;&lt; <span class="stringliteral">" appears to have element type "</span>
<a name="l00200"></a>00200                                 &lt;&lt; md_atom_name.substr(0,1)
<a name="l00201"></a>00201                                 &lt;&lt; <span class="stringliteral">", but QM partner (ID "</span> &lt;&lt; qm_atom_id
<a name="l00202"></a>00202                                 &lt;&lt; <span class="stringliteral">") has element type "</span>
<a name="l00203"></a>00203                                 &lt;&lt; intCoords.at(qm_atom_id).first &lt;&lt; endl;
<a name="l00204"></a>00204                        }
<a name="l00205"></a>00205                    }
<a name="l00206"></a>00206                    <span class="keywordflow">catch</span> (out_of_range) {
<a name="l00207"></a>00207                        ; <span class="comment">// No QM coordinates specified</span>
<a name="l00208"></a>00208                    }
<a name="l00209"></a>00209                }
<a name="l00210"></a>00210                
<a name="l00211"></a>00211                <span class="comment">// Mapping weight</span>
<a name="l00212"></a>00212                <span class="keywordtype">double</span> <a class="code" href="namespacetable__smooth__borders.html#9fd05956de12de102e40126e4c89f521">weight</a> = <a class="code" href="namespacevotca_1_1tools.html#9530f61e1349b569382075f9e63a4fa6">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;(*it_atom_weight);
<a name="l00213"></a>00213                <span class="keywordflow">if</span> (!hasQMPart &amp;&amp; weight != 0) {
<a name="l00214"></a>00214                    cout &lt;&lt; <span class="stringliteral">"ERROR: "</span>
<a name="l00215"></a>00215                         &lt;&lt; <span class="stringliteral">"Atom "</span> &lt;&lt; md_atom_name &lt;&lt; <span class="stringliteral">" in residue "</span>
<a name="l00216"></a>00216                         &lt;&lt; residue_name &lt;&lt; <span class="stringliteral">" in molecule "</span> &lt;&lt; molMdName
<a name="l00217"></a>00217                         &lt;&lt; <span class="stringliteral">" has no QM counterpart despite non-zero weight. "</span>
<a name="l00218"></a>00218                         &lt;&lt; endl;
<a name="l00219"></a>00219                    <span class="keywordflow">throw</span> runtime_error( <span class="stringliteral">"Error in mapping file"</span> );
<a name="l00220"></a>00220                }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222                <span class="comment">// Create atom</span>
<a name="l00223"></a>00223                <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a> *atom = <a class="code" href="classMd2QmEngine.html#3420d8c44df46e9c38c345302da3cf9f">AddAtomType</a>(molecule,
<a name="l00224"></a>00224                                              residue_name, residue_number,
<a name="l00225"></a>00225                                              md_atom_name, md_atom_id++,
<a name="l00226"></a>00226                                              hasQMPart,    qm_atom_id,
<a name="l00227"></a>00227                                              qmPos,        element,
<a name="l00228"></a>00228                                              weight);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230                <span class="keywordflow">try</span> {
<a name="l00231"></a>00231                    this-&gt;<a class="code" href="classMd2QmEngine.html#d17ae15352be8825e6553d240aec457a">_map_mol_resNr_atm_atmType</a>.at(molMdName)
<a name="l00232"></a>00232                                                    .at(residue_number)
<a name="l00233"></a>00233                                                    .at(md_atom_name);
<a name="l00234"></a>00234                    <span class="comment">// If this succeeded, atom has already been defined:</span>
<a name="l00235"></a>00235                    cout &lt;&lt; <span class="stringliteral">"ERROR: "</span>
<a name="l00236"></a>00236                         &lt;&lt; <span class="stringliteral">"Ambiguous atom definition in molecule "</span>
<a name="l00237"></a>00237                         &lt;&lt; molMdName &lt;&lt; <span class="stringliteral">": "</span>
<a name="l00238"></a>00238                         &lt;&lt; <span class="stringliteral">"Atom "</span> &lt;&lt; md_atom_name &lt;&lt; <span class="stringliteral">" in residue "</span>
<a name="l00239"></a>00239                         &lt;&lt; residue_number &lt;&lt; <span class="stringliteral">" exists more than once. "</span>
<a name="l00240"></a>00240                         &lt;&lt; endl;
<a name="l00241"></a>00241                    <span class="keywordflow">throw</span> runtime_error( <span class="stringliteral">"Ambiguity in atom definition."</span> );
<a name="l00242"></a>00242                }
<a name="l00243"></a>00243                <span class="keywordflow">catch</span> ( out_of_range ) {
<a name="l00244"></a>00244                    this-&gt;<a class="code" href="classMd2QmEngine.html#d17ae15352be8825e6553d240aec457a">_map_mol_resNr_atm_atmType</a>[molMdName]
<a name="l00245"></a>00245                                                    [residue_number]
<a name="l00246"></a>00246                                                    [md_atom_name] = atom;
<a name="l00247"></a>00247                }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                fragment-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#ee895e2820c748b2d2966b046e9fe01a">AddAtom</a>(atom);
<a name="l00250"></a>00250                segment-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#645ed582d1690d24bcba6b8b7de8abea">AddAtom</a>(atom);
<a name="l00251"></a>00251                molecule-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#34d078bb8248499347f2f8a54487810d">AddAtom</a>(atom);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253              } <span class="comment">/* exit loop over atoms */</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255           } <span class="comment">/* exit loop over fragments */</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257        } <span class="comment">/* exit loop over segments */</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     } <span class="comment">/* exit loop over molecules */</span>
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 
<a name="l00271"></a><a class="code" href="classMd2QmEngine.html#96b1b69e5cd7b0d994abcaa3d59ea835">00271</a> <span class="keywordtype">void</span> <a class="code" href="classMd2QmEngine.html#96b1b69e5cd7b0d994abcaa3d59ea835">Md2QmEngine::Md2Qm</a>(<a class="code" href="classvotca_1_1csg_1_1Topology.html" title="topology of the whole system">CSG::Topology</a> *mdtop, <a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">CTP::Topology</a> *qmtop) {
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a69398a07db2978a3e8dc238f0d132d2">CleanUp</a>();
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment">// Create periodic box</span>
<a name="l00276"></a>00276     qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#cbbf3b2312de6403e97554ada4cf9b31">setBox</a>(mdtop-&gt;<a class="code" href="classvotca_1_1csg_1_1Topology.html#17c77ff03972cf2744dbf308636f30cf">getBox</a>());
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="comment">// Set trajectory meta data</span>
<a name="l00279"></a>00279     qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#6b152f6ffddcaf4173f4f4c6c9697088">setStep</a>(mdtop-&gt;<a class="code" href="classvotca_1_1csg_1_1Topology.html#81334a5f36caa3e78ebb8759881b4288">getStep</a>());
<a name="l00280"></a>00280     qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ffae8470d03baf5025887e5c1b068ba5">setTime</a>(mdtop-&gt;<a class="code" href="classvotca_1_1csg_1_1Topology.html#1c9be221d3a494044d92e3283fe42da6">getTime</a>());
<a name="l00281"></a>00281     qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#314d62d68751d83b5268623dad643351">setCanRigidify</a>(<span class="keyword">true</span>);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="comment">// Add types (=&gt; Segment types / QM units)</span>
<a name="l00284"></a>00284     vector&lt; CTP::SegmentType* &gt; ::iterator typeit;
<a name="l00285"></a>00285     <span class="keywordflow">for</span> (typeit = this-&gt;<a class="code" href="classMd2QmEngine.html#0926f40e61226d681ae1f7be985de0c8">_qmUnits</a>.begin();
<a name="l00286"></a>00286          typeit != this-&gt;<a class="code" href="classMd2QmEngine.html#0926f40e61226d681ae1f7be985de0c8">_qmUnits</a>.end();
<a name="l00287"></a>00287          typeit++) {
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="keywordtype">string</span> name = (*typeit)-&gt;getName();
<a name="l00290"></a>00290         <span class="keywordtype">string</span> basis = (*typeit)-&gt;getBasisName();
<a name="l00291"></a>00291         <span class="keywordtype">string</span> orbitals = (*typeit)-&gt;getOrbitalsFile();
<a name="l00292"></a>00292         <span class="keywordtype">string</span> qmcoords = (*typeit)-&gt;getQMCoordsFile();
<a name="l00293"></a>00293         <span class="keywordtype">bool</span> canRigidify = (*typeit)-&gt;canRigidify();
<a name="l00294"></a>00294         <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">CTP::SegmentType</a> *segType = qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#a7c71362c80fc9c314b0fb117be2566f">AddSegmentType</a>(name);
<a name="l00295"></a>00295         segType-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#dd2714700ce5f5d0b94d058b642d9358">setBasisName</a>(basis);
<a name="l00296"></a>00296         segType-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#62dca561c0c19523f376569d735012a6">setOrbitalsFile</a>(orbitals);
<a name="l00297"></a>00297         segType-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#dabdd1fcb7f87fec09a5c31574ae668e">setQMCoordsFile</a>(qmcoords);
<a name="l00298"></a>00298         segType-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#830d83e747d0050d9124544c67e721ac">setCanRigidify</a>(canRigidify);
<a name="l00299"></a>00299         <span class="keywordflow">if</span> (!canRigidify) { qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#314d62d68751d83b5268623dad643351">setCanRigidify</a>(<span class="keyword">false</span>); }
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">// Populate topology in a trickle-down manner</span>
<a name="l00303"></a>00303     <span class="comment">// (i.e. molecules =&gt; ... ... =&gt; atoms)</span>
<a name="l00304"></a>00304     CSG::MoleculeContainer::iterator mit;
<a name="l00305"></a>00305     <span class="keywordflow">for</span> (mit = mdtop-&gt;<a class="code" href="classvotca_1_1csg_1_1Topology.html#09854528dfe5a72d914e75bb41f133c6">Molecules</a>().begin();
<a name="l00306"></a>00306          mit != mdtop-&gt;<a class="code" href="classvotca_1_1csg_1_1Topology.html#09854528dfe5a72d914e75bb41f133c6">Molecules</a>().end();
<a name="l00307"></a>00307          mit++ ) {
<a name="l00308"></a>00308 
<a name="l00309"></a>00309          <span class="comment">// MD molecule + name</span>
<a name="l00310"></a>00310          <a class="code" href="classvotca_1_1csg_1_1Molecule.html" title="information about molecules">CSG::Molecule</a> *molMD = *mit;
<a name="l00311"></a>00311          <span class="keywordtype">string</span> nameMolMD = molMD-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#caab8d33edc32fe9e2a7fb43314887e1" title="get the name of the molecule">getName</a>();
<a name="l00312"></a>00312 
<a name="l00313"></a>00313          <span class="comment">// Find QM counterpart</span>
<a name="l00314"></a>00314          <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *molQM = this-&gt;<a class="code" href="classMd2QmEngine.html#cc0b8011ff794d4bf8f08a663e9c5548">MoleculeFactory</a>(molMD);
<a name="l00315"></a>00315          <span class="keywordtype">string</span> nameMolQM = molQM-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#87dce0b25175392663fb3cfedb019ee6" title="Returns the name of the molecule.">getName</a>();
<a name="l00316"></a>00316 
<a name="l00317"></a>00317          <span class="comment">// Generate and export</span>
<a name="l00318"></a>00318          <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *product = this-&gt;<a class="code" href="classMd2QmEngine.html#d2e075dc7269fe593ac46175eda0e5da">ExportMolecule</a>(molQM, qmtop);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 
<a name="l00329"></a><a class="code" href="classMd2QmEngine.html#cc0b8011ff794d4bf8f08a663e9c5548">00329</a> <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *<a class="code" href="classMd2QmEngine.html#cc0b8011ff794d4bf8f08a663e9c5548">Md2QmEngine::MoleculeFactory</a>(<a class="code" href="classvotca_1_1csg_1_1Molecule.html" title="information about molecules">CSG::Molecule</a> *molMDTemplate) {
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordtype">string</span> nameMolQM = this-&gt;<a class="code" href="classMd2QmEngine.html#d58696d6b1c524ad6296974145b3563f">getMoleculeName</a>(molMDTemplate-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#caab8d33edc32fe9e2a7fb43314887e1" title="get the name of the molecule">getName</a>());
<a name="l00332"></a>00332     <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *molQMTemplate = this-&gt;<a class="code" href="classMd2QmEngine.html#a6a132ac3b14f876b549661143feff43">getMoleculeType</a>(nameMolQM);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="keywordtype">int</span> resnrOffset = molMDTemplate-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#b2245f939b0680f85aeacf81ceb97fdb" title="get the id of a bead in the molecule">getBead</a>(0)-&gt;getResnr();
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; molMDTemplate-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#2ae32e4dc7124badb92a291018437915" title="get the number of beads in the molecule">BeadCount</a>(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00337"></a>00337         <a class="code" href="classvotca_1_1csg_1_1Bead.html" title="information about a bead">CSG::Bead</a> *atomMD = molMDTemplate-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#b2245f939b0680f85aeacf81ceb97fdb" title="get the id of a bead in the molecule">getBead</a>(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00338"></a>00338         <span class="keywordflow">try</span> {
<a name="l00339"></a>00339             <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a> *counterpart =
<a name="l00340"></a>00340                  this-&gt;<a class="code" href="classMd2QmEngine.html#d3edf30b5cb03cb97db61779c4e4d60a">getAtomType</a>(molMDTemplate-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#caab8d33edc32fe9e2a7fb43314887e1" title="get the name of the molecule">getName</a>(),
<a name="l00341"></a>00341                                    atomMD-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#cdb7491b2507bdafe8f973d36918580e">getResnr</a>()-resnrOffset+1,
<a name="l00342"></a>00342                                    atomMD-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ee92364498501cda96eec9dd9cb90c37">getName</a>());
<a name="l00343"></a>00343             counterpart-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#c5128302d7034d92851c934052c0825a">setPos</a>(atomMD-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#feb069f0e094fc7b4e1da07efe9751ce">getPos</a>());
<a name="l00344"></a>00344         }
<a name="l00345"></a>00345         <span class="keywordflow">catch</span> (out_of_range) {
<a name="l00346"></a>00346             cout &lt;&lt; <span class="stringliteral">"WARNING: No mapping instruction found for atom "</span>
<a name="l00347"></a>00347                  &lt;&lt; atomMD-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ee92364498501cda96eec9dd9cb90c37">getName</a>() &lt;&lt; <span class="stringliteral">" in residue number "</span>
<a name="l00348"></a>00348                  &lt;&lt; atomMD-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#cdb7491b2507bdafe8f973d36918580e">getResnr</a>() &lt;&lt; <span class="stringliteral">" in molecule "</span>
<a name="l00349"></a>00349                  &lt;&lt; molMDTemplate-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#caab8d33edc32fe9e2a7fb43314887e1" title="get the name of the molecule">getName</a>() &lt;&lt; <span class="stringliteral">". Skipping..."</span>
<a name="l00350"></a>00350                  &lt;&lt; endl;
<a name="l00351"></a>00351         }
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353     <span class="keywordflow">return</span> molQMTemplate;
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00366"></a><a class="code" href="classMd2QmEngine.html#d2e075dc7269fe593ac46175eda0e5da">00366</a> <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *<a class="code" href="classMd2QmEngine.html#d2e075dc7269fe593ac46175eda0e5da">Md2QmEngine::ExportMolecule</a>(<a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *refMol,
<a name="l00367"></a>00367                                            <a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">CTP::Topology</a> *qmtop) {
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *newMol = qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#ac4c4795cf4928f15386c2c914f46c85">AddMolecule</a>(refMol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#87dce0b25175392663fb3cfedb019ee6" title="Returns the name of the molecule.">getName</a>());
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="comment">// Note: The topology is responsible for allocating IDs to</span>
<a name="l00372"></a>00372     <span class="comment">//       molecules, segments, ...</span>
<a name="l00373"></a>00373     
<a name="l00374"></a>00374     vector&lt;CTP::Segment *&gt; ::iterator segIt;
<a name="l00375"></a>00375     <span class="keywordflow">for</span> (segIt = refMol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#33f26b9ab32be5a9a53dc2e23d835690">Segments</a>().begin();
<a name="l00376"></a>00376          segIt &lt; refMol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#33f26b9ab32be5a9a53dc2e23d835690">Segments</a>().end();
<a name="l00377"></a>00377          segIt++) {
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a> *refSeg = *segIt;
<a name="l00380"></a>00380         <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a> *newSeg = qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#3257eb92b688c3336ffa4e4691d87bd1">AddSegment</a>(refSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f5a55c31af0b42d2da34ea68c833a8bd">getName</a>());
<a name="l00381"></a>00381         newSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f8b60aaed29fd6dd25db47bebb74b01b">setType</a>( qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#1d0cae31ad0edd07323b2255064b9394">getSegmentType</a>(refSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#242835d4f11b859eaee13f8d9f19da72">getType</a>()-&gt;getId()) );
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         vector&lt;CTP::Fragment *&gt; ::iterator fragIt;
<a name="l00384"></a>00384         <span class="keywordflow">for</span> (fragIt = refSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();
<a name="l00385"></a>00385              fragIt &lt; refSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();
<a name="l00386"></a>00386              fragIt++) {
<a name="l00387"></a>00387 
<a name="l00388"></a>00388             <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a> *refFrag = *fragIt;
<a name="l00389"></a>00389             <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a> *newFrag = qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#d6259af183b96b3af7189d7d83616f1f">AddFragment</a>(refFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#fb2bfd5a74a05b79e478c1d9d62a5d50">getName</a>());
<a name="l00390"></a>00390             newFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#3aa974a0a07ae970691a2fe0cab7a69c">setTrihedron</a>(refFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#27a5619f09c8f0af88c7a634358dcb9a">getTrihedron</a>());
<a name="l00391"></a>00391 
<a name="l00392"></a>00392             vector&lt;CTP::Atom *&gt; ::iterator atomIt;
<a name="l00393"></a>00393             <span class="keywordflow">for</span> (atomIt = refFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().begin();
<a name="l00394"></a>00394                  atomIt &lt; refFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().end();
<a name="l00395"></a>00395                  atomIt++) {
<a name="l00396"></a>00396 
<a name="l00397"></a>00397                 <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a> *refAtom = *atomIt;
<a name="l00398"></a>00398                 <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a> *newAtom = qmtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#689cdbd91a064dbc5ae4cad2ff5e4f22">AddAtom</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#172eb27d09bcfce0559c0e8053981e23">getName</a>());
<a name="l00399"></a>00399 
<a name="l00400"></a>00400                 newAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#4de0f423fb33e994b3f90c3bf95d260d">setWeight</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#72dec1122103687fe5698bae1b9a5b8e">getWeight</a>());
<a name="l00401"></a>00401                 newAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#731d587ae8fa5e988e979500649401f5">setResnr</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#b09f5d4961d04c58cbbcbbfbe175126b">getResnr</a>());
<a name="l00402"></a>00402                 newAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#fa40447d0d0d9577de9c2134e19fb9bd">setResname</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#6342d0f7eed793108c12563511480039">getResname</a>());
<a name="l00403"></a>00403                 newAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#6dec530fdf8854d5ceb532aa358896d7">setElement</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#0de5b404b9ce3b8c6f3d7733cfcfd65d">getElement</a>());
<a name="l00404"></a>00404                 <span class="keywordflow">if</span> (refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#107a4e4f4bf768649dac2bdac355af19">HasQMPart</a>()) {
<a name="l00405"></a>00405                     newAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#f888a363386c5a93530efcfc1234427e">setQMPart</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#8cddf9c6f70bc57eb5275f28e54cfc20">getQMId</a>(),
<a name="l00406"></a>00406                                        refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#b0227bd1466d92cf9d3f33621a863265">getQMPos</a>());
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408                 newAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#c5128302d7034d92851c934052c0825a">setPos</a>(refAtom-&gt;<a class="code" href="classvotca_1_1ctp_1_1Atom.html#eaaedc427b46cab7d6325c68eb75770e">getPos</a>());
<a name="l00409"></a>00409 
<a name="l00410"></a>00410                 newFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#ee895e2820c748b2d2966b046e9fe01a">AddAtom</a>(newAtom);
<a name="l00411"></a>00411                 newSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#645ed582d1690d24bcba6b8b7de8abea">AddAtom</a>(newAtom);
<a name="l00412"></a>00412                 newMol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#34d078bb8248499347f2f8a54487810d">AddAtom</a>(newAtom);
<a name="l00413"></a>00413             } <span class="comment">/* exit loop over template atoms */</span>
<a name="l00414"></a>00414             newFrag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#f4bc01f7f4efedce1ecba7acda3f50f4">calcPos</a>();
<a name="l00415"></a>00415             newSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f96d1b8363630b002e5a1768f31d16a1">AddFragment</a>(newFrag);
<a name="l00416"></a>00416             newMol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#f5f603d9c704b7565b80ad10a58e74bf">AddFragment</a>(newFrag);
<a name="l00417"></a>00417         } <span class="comment">/* exit loop over template fragments */</span>
<a name="l00418"></a>00418         newSeg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#24f34012b649ade3bb8c7437cf6c0ab4">calcPos</a>();
<a name="l00419"></a>00419         newMol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#b075d2195d8919218a67a655c51a3c82">AddSegment</a>(newSeg);
<a name="l00420"></a>00420     } <span class="comment">/* exit loop over template molecules */</span>
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="classMd2QmEngine.html#3420d8c44df46e9c38c345302da3cf9f">00426</a> <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a> *<a class="code" href="classMd2QmEngine.html#3420d8c44df46e9c38c345302da3cf9f">Md2QmEngine::AddAtomType</a>(<a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *owner,
<a name="l00427"></a>00427                                     <span class="keywordtype">string</span> residue_name,  <span class="keywordtype">int</span> residue_number,
<a name="l00428"></a>00428                                     <span class="keywordtype">string</span> md_atom_name,  <span class="keywordtype">int</span> md_atom_id,
<a name="l00429"></a>00429                                     <span class="keywordtype">bool</span> hasQMPart,       <span class="keywordtype">int</span> qm_atom_id,
<a name="l00430"></a>00430                                     <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> qmPos,            <span class="keywordtype">string</span> element,
<a name="l00431"></a>00431                                     <span class="keywordtype">double</span> <a class="code" href="namespacetable__smooth__borders.html#9fd05956de12de102e40126e4c89f521">weight</a>) {
<a name="l00432"></a>00432     <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a>* atom = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a>(owner,
<a name="l00433"></a>00433                                     residue_name,         residue_number,
<a name="l00434"></a>00434                                     md_atom_name,         md_atom_id,
<a name="l00435"></a>00435                                     hasQMPart,            qm_atom_id,
<a name="l00436"></a>00436                                     qmPos,                element,
<a name="l00437"></a>00437                                     weight);
<a name="l00438"></a>00438     <a class="code" href="classMd2QmEngine.html#aaf114dafe54d0882389b8290ca02f6e">_atom_types</a>.push_back(atom);
<a name="l00439"></a>00439     <span class="keywordflow">return</span> atom;
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a><a class="code" href="classMd2QmEngine.html#86781454995f772d738f0670ac0e030a">00442</a> <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a> *<a class="code" href="classMd2QmEngine.html#86781454995f772d738f0670ac0e030a">Md2QmEngine::AddFragmentType</a>(<span class="keywordtype">int</span> fragment_id,
<a name="l00443"></a>00443                                             <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *property) {
<a name="l00444"></a>00444     <span class="keywordtype">string</span> fragment_name = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"name"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00445"></a>00445     <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a>* fragment = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a>(fragment_id, fragment_name);
<a name="l00446"></a>00446     <a class="code" href="classMd2QmEngine.html#83e2f5142d73a2ff0d9b66e8afaa46d7">_fragment_types</a>.push_back(fragment);
<a name="l00447"></a>00447     <span class="keywordflow">return</span> fragment;
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00450"></a><a class="code" href="classMd2QmEngine.html#afbf87d1af3326b588d4c75b240f0275">00450</a> <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a>  *<a class="code" href="classMd2QmEngine.html#afbf87d1af3326b588d4c75b240f0275">Md2QmEngine::AddSegmentType</a>(<span class="keywordtype">int</span> segment_id,
<a name="l00451"></a>00451                                            <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *property) {
<a name="l00452"></a>00452     <span class="keywordtype">string</span> segment_name = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"name"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00453"></a>00453     <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a>* segment = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a>(segment_id, segment_name);
<a name="l00454"></a>00454     <a class="code" href="classMd2QmEngine.html#17f721224dfbdab9bab7755c84a6b219">_segment_types</a>.push_back(segment);
<a name="l00455"></a>00455     <span class="keywordflow">return</span> segment;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a><a class="code" href="classMd2QmEngine.html#3afd4d79a70ec66396fc7dfb8fb71ced">00458</a> <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *<a class="code" href="classMd2QmEngine.html#3afd4d79a70ec66396fc7dfb8fb71ced">Md2QmEngine::AddMoleculeType</a>(<span class="keywordtype">int</span> molecule_id,
<a name="l00459"></a>00459                                             <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *property) {
<a name="l00460"></a>00460     <span class="keywordtype">string</span> molecule_name = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"name"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00461"></a>00461     <span class="keywordtype">string</span> molecule_mdname = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"mdname"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *molecule = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a>(molecule_id, molecule_name);
<a name="l00464"></a>00464     <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.push_back(molecule);
<a name="l00465"></a>00465     <span class="comment">// TODO check if the name is already there</span>
<a name="l00466"></a>00466     <a class="code" href="classMd2QmEngine.html#c05ddc9a77ff9b96f84c2db46df80360">_map_MoleculeMDName_MoleculeName</a>[molecule_mdname] = molecule_name;
<a name="l00467"></a>00467     <a class="code" href="classMd2QmEngine.html#8b5a1ede0b6bb8d6e86fdf7e0059540d">_map_MoleculeName_MoleculeType</a>[molecule_name] = molecule;
<a name="l00468"></a>00468     <span class="keywordflow">return</span> molecule;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="classMd2QmEngine.html#6374e5cc4c741376436ace928e0caf9b">00471</a> <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">CTP::SegmentType</a> *<a class="code" href="classMd2QmEngine.html#6374e5cc4c741376436ace928e0caf9b">Md2QmEngine::AddQMUnit</a>(<span class="keywordtype">int</span> qmunit_id, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *property) {
<a name="l00472"></a>00472     <span class="keywordtype">string</span> qmCoordsFile = <span class="stringliteral">"nofile"</span>;
<a name="l00473"></a>00473     <span class="keywordtype">string</span> orbitalsFile = <span class="stringliteral">"nofile"</span>;
<a name="l00474"></a>00474     <span class="keywordtype">string</span> basisSetName = <span class="stringliteral">"noname"</span>;
<a name="l00475"></a>00475     vector&lt;int&gt; torbNrs;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordtype">bool</span> canRigidify = <span class="keyword">false</span>;
<a name="l00478"></a>00478         
<a name="l00479"></a>00479     <span class="keywordtype">string</span> qmunit_name = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"name"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00480"></a>00480     
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (property-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"qmcoords"</span>)) {
<a name="l00482"></a>00482         qmCoordsFile = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"qmcoords"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00483"></a>00483         canRigidify = <span class="keyword">true</span>;
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (property-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"orbitals"</span>)) {
<a name="l00486"></a>00486         orbitalsFile = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"orbitals"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488     <span class="keywordflow">if</span> (property-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"basisset"</span>)) {
<a name="l00489"></a>00489         basisSetName = <span class="keyword">property</span>-&gt;get(<span class="stringliteral">"basisset"</span>).as&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">CTP::SegmentType</a>* qmUnit = <span class="keyword">new</span> <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">CTP::SegmentType</a>(qmunit_id,    qmunit_name,
<a name="l00493"></a>00493                                                     basisSetName, orbitalsFile,
<a name="l00494"></a>00494                                                     qmCoordsFile, canRigidify);
<a name="l00495"></a>00495     <a class="code" href="classMd2QmEngine.html#0926f40e61226d681ae1f7be985de0c8">_qmUnits</a>.push_back(qmUnit);
<a name="l00496"></a>00496     <span class="keywordflow">return</span> qmUnit;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="classMd2QmEngine.html#a6a132ac3b14f876b549661143feff43">00500</a> <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *<a class="code" href="classMd2QmEngine.html#a6a132ac3b14f876b549661143feff43">Md2QmEngine::getMoleculeType</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name) {
<a name="l00501"></a>00501     <span class="keywordflow">try</span> {
<a name="l00502"></a>00502         <span class="keywordflow">return</span> <a class="code" href="classMd2QmEngine.html#8b5a1ede0b6bb8d6e86fdf7e0059540d">_map_MoleculeName_MoleculeType</a>.at(name);
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504     <span class="keywordflow">catch</span> ( out_of_range ) {
<a name="l00505"></a>00505         cout &lt;&lt; <span class="stringliteral">"WARNING: Molecule '"</span> &lt;&lt; name
<a name="l00506"></a>00506              &lt;&lt; <span class="stringliteral">"' not included in mapping definition. Skipping... "</span>;
<a name="l00507"></a>00507         cout &lt;&lt; endl;
<a name="l00508"></a>00508         <span class="keywordflow">return</span> NULL;
<a name="l00509"></a>00509     }    
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="classMd2QmEngine.html#d58696d6b1c524ad6296974145b3563f">00512</a> <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;<a class="code" href="classMd2QmEngine.html#d58696d6b1c524ad6296974145b3563f">Md2QmEngine::getMoleculeName</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;mdname) {
<a name="l00513"></a>00513     <span class="keywordflow">try</span> {
<a name="l00514"></a>00514         <span class="keywordflow">return</span> <a class="code" href="classMd2QmEngine.html#c05ddc9a77ff9b96f84c2db46df80360">_map_MoleculeMDName_MoleculeName</a>.at(mdname);
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">catch</span> ( out_of_range ) {
<a name="l00517"></a>00517         <span class="keywordflow">return</span> mdname;
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a><a class="code" href="classMd2QmEngine.html#d3edf30b5cb03cb97db61779c4e4d60a">00521</a> <a class="code" href="classvotca_1_1ctp_1_1Atom.html" title="information about an atom">CTP::Atom</a> *<a class="code" href="classMd2QmEngine.html#d3edf30b5cb03cb97db61779c4e4d60a">Md2QmEngine::getAtomType</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;molMdName,
<a name="l00522"></a>00522                                     <span class="keywordtype">int</span> resNr, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;mdAtomName) {
<a name="l00523"></a>00523     <span class="keywordflow">return</span> this-&gt;<a class="code" href="classMd2QmEngine.html#d17ae15352be8825e6553d240aec457a">_map_mol_resNr_atm_atmType</a>.at(molMdName)
<a name="l00524"></a>00524                                            .at(resNr)
<a name="l00525"></a>00525                                            .at(mdAtomName);
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="classMd2QmEngine.html#94a78b1c5e6f84fd97530863cd8f8925">00528</a> <span class="keywordtype">void</span> <a class="code" href="classMd2QmEngine.html#94a78b1c5e6f84fd97530863cd8f8925">Md2QmEngine::getIntCoords</a>(<span class="keywordtype">string</span> &amp;file,
<a name="l00529"></a>00529                                map&lt;<span class="keywordtype">int</span>, pair&lt;string,vec&gt; &gt; &amp;intCoords) {
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="keywordtype">int</span> atomCount = 0;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     std::string line;
<a name="l00535"></a>00535     std::ifstream intt;
<a name="l00536"></a>00536     intt.open(file.c_str());
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (intt.is_open() ) {
<a name="l00539"></a>00539         <span class="keywordflow">while</span> ( intt.good() ) {
<a name="l00540"></a>00540             std::getline(intt, line);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542             vector&lt; string &gt; <a class="code" href="namespacestrings.html#12ec697adfa3201deadb7777456db11c">split</a>;
<a name="l00543"></a>00543             <a class="code" href="classvotca_1_1tools_1_1Tokenizer.html" title="break string into words">Tokenizer</a> toker(line, <span class="stringliteral">" "</span>);
<a name="l00544"></a>00544             toker.<a class="code" href="classvotca_1_1tools_1_1Tokenizer.html#344236c051d493ac32ddf310fbad24fe" title="store all words in a vector of strings.">ToVector</a>(split);
<a name="l00545"></a>00545             <span class="keywordflow">if</span> ( !split.size()    ||
<a name="l00546"></a>00546                   split[0] == <span class="stringliteral">"#"</span> ||
<a name="l00547"></a>00547                   split[0].substr(0,1) == <span class="stringliteral">"#"</span> ) { <span class="keywordflow">continue</span>; }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549             <span class="comment">// Interesting information written here: e.g. 'C 0.000 0.000 0.000'</span>
<a name="l00550"></a>00550             atomCount++;
<a name="l00551"></a>00551             <span class="keywordtype">string</span> element = split[0];
<a name="l00552"></a>00552             <span class="keywordtype">double</span> <a class="code" href="namespacelinsolve.html#dab3afc673d15a07d698016ec48d5d04">x</a> = <a class="code" href="namespacevotca_1_1tools.html#9530f61e1349b569382075f9e63a4fa6">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;( split[1] ) / 10.; <span class="comment">//A to NM</span>
<a name="l00553"></a>00553             <span class="keywordtype">double</span> y = <a class="code" href="namespacevotca_1_1tools.html#9530f61e1349b569382075f9e63a4fa6">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;( split[2] ) / 10.;
<a name="l00554"></a>00554             <span class="keywordtype">double</span> z = <a class="code" href="namespacevotca_1_1tools.html#9530f61e1349b569382075f9e63a4fa6">boost::lexical_cast</a>&lt;<span class="keywordtype">double</span>&gt;( split[3] ) / 10.;
<a name="l00555"></a>00555             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> qmPos = <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a>(x,y,z);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557             pair&lt;string, vec&gt; qmTypePos(element.substr(0,1), qmPos);
<a name="l00558"></a>00558             intCoords[atomCount] = qmTypePos;
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a><a class="code" href="classMd2QmEngine.html#c5986a7f26aa37e4c7c69e0d609bf4d3">00564</a> <span class="keywordtype">void</span> <a class="code" href="classMd2QmEngine.html#c5986a7f26aa37e4c7c69e0d609bf4d3">Md2QmEngine::PrintInfo</a>() {
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     vector&lt;CTP::Molecule*&gt;::iterator mit;
<a name="l00567"></a>00567     vector&lt;CTP::Segment*&gt;::iterator sit;
<a name="l00568"></a>00568     vector&lt;CTP::Fragment*&gt;::iterator fit;
<a name="l00569"></a>00569     vector&lt;CTP::Atom*&gt;::iterator ait;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     cout &lt;&lt; <span class="stringliteral">"Summary ~~~~~"</span>
<a name="l00572"></a>00572             <span class="stringliteral">"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span> &lt;&lt; endl;
<a name="l00573"></a>00573     cout &lt;&lt; <span class="stringliteral">"Created "</span>
<a name="l00574"></a>00574          &lt;&lt; <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.size() &lt;&lt; <span class="stringliteral">" molecule type(s): "</span>;
<a name="l00575"></a>00575     <span class="keywordflow">for</span> (mit = <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.begin();
<a name="l00576"></a>00576          mit != <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.end();
<a name="l00577"></a>00577          mit++) {
<a name="l00578"></a>00578          cout &lt;&lt; <span class="stringliteral">"[ "</span> &lt;&lt; (*mit)-&gt;getName() &lt;&lt; <span class="stringliteral">" ]"</span>;
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580     cout &lt;&lt; endl &lt;&lt;  <span class="stringliteral">"with a total of "</span>
<a name="l00581"></a>00581          &lt;&lt; <a class="code" href="classMd2QmEngine.html#17f721224dfbdab9bab7755c84a6b219">_segment_types</a>.size()  &lt;&lt; <span class="stringliteral">" segment(s), "</span>
<a name="l00582"></a>00582          &lt;&lt; <a class="code" href="classMd2QmEngine.html#83e2f5142d73a2ff0d9b66e8afaa46d7">_fragment_types</a>.size() &lt;&lt; <span class="stringliteral">" fragments, "</span>
<a name="l00583"></a>00583          &lt;&lt; <a class="code" href="classMd2QmEngine.html#aaf114dafe54d0882389b8290ca02f6e">_atom_types</a>.size() &lt;&lt; <span class="stringliteral">" atoms. \n"</span> &lt;&lt; endl;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     map &lt; string, string &gt; ::iterator mssit;
<a name="l00586"></a>00586     <span class="keywordflow">for</span> (mssit = this-&gt;<a class="code" href="classMd2QmEngine.html#c05ddc9a77ff9b96f84c2db46df80360">_map_MoleculeMDName_MoleculeName</a>.begin();
<a name="l00587"></a>00587          mssit != this-&gt;<a class="code" href="classMd2QmEngine.html#c05ddc9a77ff9b96f84c2db46df80360">_map_MoleculeMDName_MoleculeName</a>.end();
<a name="l00588"></a>00588          mssit ++) {
<a name="l00589"></a>00589          cout &lt;&lt; <span class="stringliteral">"MD [ "</span> &lt;&lt; mssit-&gt;first &lt;&lt; <span class="stringliteral">" ] mapped to "</span>
<a name="l00590"></a>00590               &lt;&lt; <span class="stringliteral">"QM [ "</span> &lt;&lt; mssit-&gt;second &lt;&lt; <span class="stringliteral">" ] \n"</span> &lt;&lt; endl;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="keywordflow">for</span> (mit = <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.begin();
<a name="l00594"></a>00594          mit != <a class="code" href="classMd2QmEngine.html#c752f6c4cff8b9753bbd9d19dfd184b9">_molecule_types</a>.end();
<a name="l00595"></a>00595          mit++) {
<a name="l00596"></a>00596          <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *mol = *mit;
<a name="l00597"></a>00597          cout &lt;&lt; <span class="stringliteral">"[ "</span> &lt;&lt; mol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#87dce0b25175392663fb3cfedb019ee6" title="Returns the name of the molecule.">getName</a>() &lt;&lt; <span class="stringliteral">" ]"</span> &lt;&lt; endl;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599          <span class="keywordflow">for</span> (sit = mol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#33f26b9ab32be5a9a53dc2e23d835690">Segments</a>().begin();
<a name="l00600"></a>00600               sit != mol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#33f26b9ab32be5a9a53dc2e23d835690">Segments</a>().end();
<a name="l00601"></a>00601               sit++) {
<a name="l00602"></a>00602               <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a> *seg = *sit;
<a name="l00603"></a>00603               cout &lt;&lt; <span class="stringliteral">" - Segment [ "</span> &lt;&lt; seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f5a55c31af0b42d2da34ea68c833a8bd">getName</a>() &lt;&lt; <span class="stringliteral">" ]"</span>
<a name="l00604"></a>00604                    &lt;&lt; <span class="stringliteral">" ID "</span> &lt;&lt; seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#83945ef058d7bb6efb596d04633bb497">getId</a>() &lt;&lt; endl;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606               <span class="keywordflow">for</span> (fit = seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();
<a name="l00607"></a>00607                    fit != seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();
<a name="l00608"></a>00608                    fit++ ) {
<a name="l00609"></a>00609                    <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">CTP::Fragment</a> *frag = *fit;
<a name="l00610"></a>00610                    cout &lt;&lt; <span class="stringliteral">"   - Fragment [ "</span> &lt;&lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#fb2bfd5a74a05b79e478c1d9d62a5d50">getName</a>() &lt;&lt; <span class="stringliteral">" ]"</span>
<a name="l00611"></a>00611                         &lt;&lt; <span class="stringliteral">" ID "</span> &lt;&lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#923551b96b820f46d78f0b260b9f4861">getId</a>() &lt;&lt; <span class="stringliteral">": "</span>
<a name="l00612"></a>00612                         &lt;&lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().size() &lt;&lt; <span class="stringliteral">" atoms "</span> &lt;&lt; endl;
<a name="l00613"></a>00613               }
<a name="l00614"></a>00614          }
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <span class="keywordflow">if</span> (! <a class="code" href="classvotca_1_1tools_1_1globals.html#68680885a1bd6265f3aacdcca5ab61c4" title="be loud and noisy">votca::tools::globals::verbose</a> ) { <span class="keywordflow">return</span>; }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"Mapping table"</span>
<a name="l00620"></a>00620                     <span class="stringliteral">" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span>
<a name="l00621"></a>00621                  &lt;&lt; endl;
<a name="l00622"></a>00622     map &lt; string, map &lt; int, map &lt; string, CTP::Atom* &gt; &gt; &gt; ::iterator it0;
<a name="l00623"></a>00623     <span class="keywordflow">for</span> (it0 = this-&gt;<a class="code" href="classMd2QmEngine.html#d17ae15352be8825e6553d240aec457a">_map_mol_resNr_atm_atmType</a>.begin();
<a name="l00624"></a>00624          it0 != this-&gt;<a class="code" href="classMd2QmEngine.html#d17ae15352be8825e6553d240aec457a">_map_mol_resNr_atm_atmType</a>.end();
<a name="l00625"></a>00625          it0 ++) {
<a name="l00626"></a>00626          map &lt; int, map &lt; string, CTP::Atom* &gt; &gt; ::iterator it1;
<a name="l00627"></a>00627          <span class="keywordflow">for</span> (it1 = it0-&gt;second.begin();
<a name="l00628"></a>00628               it1 != it0-&gt;second.end();
<a name="l00629"></a>00629               it1++) {
<a name="l00630"></a>00630               map &lt; string, CTP::Atom* &gt; ::iterator it2;
<a name="l00631"></a>00631               <span class="keywordflow">for</span> (it2 = it1-&gt;second.begin();
<a name="l00632"></a>00632                    it2 != it1-&gt;second.end();
<a name="l00633"></a>00633                    it2++) {
<a name="l00634"></a>00634 
<a name="l00635"></a>00635        printf( <span class="stringliteral">"MD Molecule %4s | Residue %2d | Atom %3s "</span>
<a name="l00636"></a>00636                                <span class="stringliteral">"| ID %3d =&gt; QM ID %3d \n"</span>,
<a name="l00637"></a>00637                it0-&gt;first.c_str(),
<a name="l00638"></a>00638                it2-&gt;second-&gt;getResnr(),
<a name="l00639"></a>00639                it2-&gt;first.c_str(),
<a name="l00640"></a>00640                it2-&gt;second-&gt;getId(),
<a name="l00641"></a>00641                it2-&gt;second-&gt;getQMId());
<a name="l00642"></a>00642              }
<a name="l00643"></a>00643          }
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645 }
<a name="l00646"></a>00646 
<a name="l00647"></a><a class="code" href="classMd2QmEngine.html#1d905bcdcfe1230f74c462f8dda5c035">00647</a> <span class="keywordtype">void</span> <a class="code" href="classMd2QmEngine.html#1d905bcdcfe1230f74c462f8dda5c035">Md2QmEngine::CheckProduct</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">CTP::Topology</a> *outtop, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;pdbfile) {
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <span class="keywordtype">string</span> md_pdb = <span class="stringliteral">"md_"</span> + pdbfile;
<a name="l00650"></a>00650     <span class="keywordtype">string</span> qm1_pdb = <span class="stringliteral">"qm_rigid_"</span> + pdbfile;
<a name="l00651"></a>00651     <span class="keywordtype">string</span> qm2_pdb = <span class="stringliteral">"qm_conjg_"</span> + pdbfile;
<a name="l00652"></a>00652     FILE *outPDB = NULL;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="comment">// Atomistic PDB</span>
<a name="l00655"></a>00655     outPDB = fopen(md_pdb.c_str(), <span class="stringliteral">"w"</span>);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     vector&lt;CTP::Molecule*&gt; ::iterator molIt;
<a name="l00658"></a>00658     <span class="keywordflow">for</span> (molIt = outtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#d42bc7d62d50077d3cc4b177ff30af4e">Molecules</a>().begin();
<a name="l00659"></a>00659          molIt &lt; outtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#d42bc7d62d50077d3cc4b177ff30af4e">Molecules</a>().end();
<a name="l00660"></a>00660          molIt++) {
<a name="l00661"></a>00661         <a class="code" href="classvotca_1_1ctp_1_1Molecule.html">CTP::Molecule</a> *mol = *molIt;
<a name="l00662"></a>00662         mol-&gt;<a class="code" href="classvotca_1_1ctp_1_1Molecule.html#14284022baea6da47715adab8b31f9cf" title="Writes a PDB file.">WritePDB</a>(outPDB);
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     fprintf(outPDB, <span class="stringliteral">"\n"</span>);
<a name="l00666"></a>00666     fclose(outPDB);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="comment">// Fragment PDB</span>
<a name="l00670"></a>00670     outPDB = fopen(qm1_pdb.c_str(), <span class="stringliteral">"w"</span>);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     vector&lt;CTP::Segment*&gt; ::iterator segIt;
<a name="l00673"></a>00673     <span class="keywordflow">for</span> (segIt = outtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().begin();
<a name="l00674"></a>00674          segIt &lt; outtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#8574c0f1d39f227a22b6bb398adeb9fd">Segments</a>().end();
<a name="l00675"></a>00675          segIt++) {
<a name="l00676"></a>00676         <a class="code" href="classvotca_1_1ctp_1_1Segment.html">CTP::Segment</a> *seg = *segIt;
<a name="l00677"></a>00677         seg-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#fd3fbb27f85d1eb59fef74054f3b6fd5">WritePDB</a>(outPDB);
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     fprintf(outPDB, <span class="stringliteral">"\n"</span>);
<a name="l00681"></a>00681     fclose(outPDB);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="comment">// Segment PDB</span>
<a name="l00685"></a>00685     outPDB = fopen(qm2_pdb.c_str(), <span class="stringliteral">"w"</span>);
<a name="l00686"></a>00686     outtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#fd4e8811e3213fba7b37819121c494f6">WritePDB</a>(outPDB);
<a name="l00687"></a>00687     fprintf(outPDB, <span class="stringliteral">"\n"</span>);
<a name="l00688"></a>00688     fclose(outPDB);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1tools_1_1globals.html#68680885a1bd6265f3aacdcca5ab61c4" title="be loud and noisy">TOOLS::globals::verbose</a>) {
<a name="l00692"></a>00692         cout &lt;&lt; endl;
<a name="l00693"></a>00693         this-&gt;<a class="code" href="classMd2QmEngine.html#c5986a7f26aa37e4c7c69e0d609bf4d3">PrintInfo</a>();
<a name="l00694"></a>00694         cout &lt;&lt; endl;
<a name="l00695"></a>00695         outtop-&gt;<a class="code" href="classvotca_1_1ctp_1_1Topology.html#bcf28ff9bf5e538beeb0cffd8bce3af7">PrintInfo</a>(cout);
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
